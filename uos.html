<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UOS Mock Test Batch 2k26 - Test 3</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- MathJax -->
    <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- jsPDF with enhanced features -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #0dcaf0;
            --light-color: #f8f9fa;
            --dark-color: #212529;
        }

        [data-theme="dark"] {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #0dcaf0;
            --light-color: #212529;
            --dark-color: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light-color);
            color: var(--dark-color);
            transition: all 0.3s ease;
        }

        [data-theme="dark"] body {
            background: var(--dark-color);
            color: var(--light-color);
        }

        .header-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        [data-theme="dark"] .header-gradient {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        }

        /* Ensure proper centering on all devices */
        .text-center-mobile {
            text-align: center;
        }
        
        .btn-full-width-mobile {
            width: 100%;
        }
        
        .flex-column-mobile {
            flex-direction: column;
        }
        
        .align-items-center-mobile {
            align-items: center;
        }
        
        .justify-content-center-mobile {
            justify-content: center;
        }
        
        /* Responsive card adjustments */
        .card {
            margin-bottom: 15px;
        }
        
        /* Responsive option cards */
        .option-card {
            transition: all 0.3s ease;
            margin: 8px 0;
        }
        
        /* Responsive button adjustments */
        .btn-custom {
            margin: 4px;
            transition: all 0.3s ease;
        }

        .header-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        [data-theme="dark"] .header-gradient {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        }

        .question-palette {
            max-height: 80px;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            margin-top: 15px;
            padding: 10px; /* Add padding */
            background: rgba(0,0,0,0.03); /* Light background */
            border-radius: 8px; /* Rounded corners */
        }

        [data-theme="dark"] .question-palette {
            background: rgba(255,255,255,0.1);
        }

        .question-number {
            min-width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            background: white;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 3px; /* Add horizontal margin for spacing */
            font-weight: 500; /* Make numbers bolder */
        }

        [data-theme="dark"] .question-number {
            background: #495057;
            color: white;
            border-color: #6c757d;
        }

        .question-number:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .question-number.current {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: bold;
            transform: scale(1.1); /* Slightly enlarge current question */
        }

        .question-number.answered {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        .question-number.flagged {
            background: var(--warning-color);
            color: black;
            border-color: var(--warning-color);
        }

        .question-number.flagged.answered {
            background: var(--info-color);
            color: white;
            border-color: var(--info-color);
        }

        .timer {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Shake animation for password error */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .animate__shakeX {
            animation: shake 0.5s ease-in-out;
        }

        .option-card {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px 20px; /* Increased padding for better spacing */
            margin: 10px 0; /* Increased margin for better separation */
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            position: relative; /* For better positioning */
        }

        [data-theme="dark"] .option-card {
            background: #495057;
            border-color: #6c757d;
            color: white;
        }

        .option-card:hover {
            border-color: var(--primary-color);
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(13, 110, 253, 0.2);
        }

        .option-card.selected {
            border-color: var(--primary-color);
            background: rgba(13, 110, 253, 0.1);
            font-weight: 500; /* Make selected options bolder */
        }

        .btn-custom {
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
            margin: 5px; /* Add margin for better spacing between buttons */
        }

        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .result-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .card-header {
            padding: 25px; /* Increase padding for better spacing */
        }

        .card-footer {
            padding: 20px; /* Increase padding for better spacing */
            background-color: #f8f9fa;
        }

        [data-theme="dark"] .card-footer {
            background-color: #343a40;
        }

        .review-correct {
            background: rgba(25, 135, 84, 0.1);
            border-left: 4px solid var(--success-color);
        }

        .review-incorrect {
            background: rgba(220, 53, 69, 0.1);
            border-left: 4px solid var(--danger-color);
        }

        .review-unattempted {
            background: rgba(108, 117, 125, 0.1);
            border-left: 4px solid var(--secondary-color);
        }

        .modal-custom {
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* MathJax Styling */
        .MathJax {
            font-size: 1.1em !important;
        }

        .question-content .MathJax {
            font-size: 1.2em !important;
        }

        /* PDF Progress Modal */
        .pdf-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .pdf-progress-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .progress-bar-custom {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .retake-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
            transition: all 0.3s ease;
        }

        .retake-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(40, 167, 69, 0.6);
            background: linear-gradient(45deg, #218838, #1e7e34);
        }

        @media (max-width: 768px) {
            .question-palette {
                max-height: 60px;
            }
            
            .question-number {
                min-width: 35px;
                height: 35px;
                font-size: 12px;
            }
            
            .timer {
                font-size: 14px;
                padding: 8px 16px;
            }
            
            .floating-btn {
                width: 50px;
                height: 50px;
                bottom: 20px;
                right: 20px;
            }

            .MathJax {
                font-size: 1em !important;
            }
            
            /* Center buttons only on mobile */
            .card-footer .btn-custom {
                width: 100%;
                margin: 5px 0;
            }
            
            .modal-footer .btn-custom, .modal-footer .retake-btn {
                width: 100%;
                margin: 5px 0;
            }
            
            /* Center navigation buttons on mobile */
            .text-md-end {
                text-align: center !important;
            }
        }
        
        /* Additional mobile-specific styles for better responsiveness */
        @media (max-width: 576px) {
            .header-gradient h1 {
                font-size: 1.2rem;
                text-align: center;
            }
            
            .timer {
                font-size: 12px;
                padding: 6px 12px;
            }
            
            .question-number {
                min-width: 30px;
                height: 30px;
                font-size: 10px;
                margin: 0 2px;
            }
            
            .btn-custom {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
   
</head>
<body>
    <!-- PDF Progress Modal -->
    <div class="pdf-progress" id="pdfProgress">
        <div class="pdf-progress-content">
            <h4><i class="fas fa-file-pdf text-danger me-2"></i>Generating PDF Report</h4>
            <div class="progress-bar-custom">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="progressText">Preparing document...</p>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- Password Modal -->
    <div class="modal fade" id="passwordModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-lock me-2"></i>Secure Access Required</h5>
                </div>
                <div class="modal-body text-center">
                    <div class="mb-4">
                        <i class="fas fa-shield-alt fa-3x text-primary mb-3"></i>
                        <h6>Enter Password to Access Test</h6>
                    </div>
                    <input type="password" class="form-control text-center" id="passwordInput" 
                           placeholder="Enter Password" maxlength="20">
                    <div class="invalid-feedback" id="passwordError"></div>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-primary btn-custom" onclick="verifyPassword()">
                        <i class="fas fa-key me-2"></i>Access Test
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" style="display: none;">
        <!-- Header -->
        <header class="header-gradient text-white py-4 shadow-lg">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="h3 mb-0"><i class="fas fa-graduation-cap me-2"></i>UOS Mock Test Batch 2k26 - Test 3</h1>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <div class="d-flex align-items-center justify-content-md-end justify-content-center gap-3">
                            <div class="timer" id="timer">90:00</div>
                            <button class="btn btn-outline-light btn-sm" onclick="toggleTheme()" id="themeToggle">
                                <i class="fas fa-moon"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Test Area -->
        <main class="container my-4">
            <div class="row">
                <div class="col-12">
                    <div class="card shadow-lg border-0" id="questionCard">
                        <div class="card-header bg-primary text-white">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h5 class="mb-0">Question <span id="currentQuestionNum">1</span> of 100</h5>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <button class="btn btn-warning btn-sm" onclick="toggleFlag()" id="flagBtn">
                                        <i class="fas fa-flag me-1"></i>Flag
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <div id="questionContent" class="question-content">
                                <!-- Question content will be loaded here -->
                            </div>
                            <div id="optionsContent" class="mt-4">
                                <!-- Options will be loaded here -->
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="row">
                                <div class="col-md-6">
                                    <button class="btn btn-secondary btn-custom" onclick="previousQuestion()" id="prevBtn">
                                        <i class="fas fa-chevron-left me-2"></i>Previous
                                    </button>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <button class="btn btn-primary btn-custom" onclick="nextQuestion()" id="nextBtn">
                                        Next<i class="fas fa-chevron-right ms-2"></i>
                                    </button>
                                    <button class="btn btn-success btn-custom" onclick="submitTest()" id="submitBtn" style="display: none;">
                                        <i class="fas fa-paper-plane me-2"></i>Submit Test
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Question Palette moved to bottom -->
        <div class="container-fluid bg-light py-3 mt-4" data-theme-bg="secondary">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <h6 class="mb-2"><i class="fas fa-list-ol me-2"></i>Question Palette</h6>
                        <div class="question-palette" id="questionPalette">
                            <!-- Question numbers will be generated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Result Modal -->
        <div class="modal fade" id="resultModal" tabindex="-1" data-bs-backdrop="static">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title"><i class="fas fa-trophy me-2"></i>Test Results</h5>
                    </div>
                    <div class="modal-body">
                        <div class="result-card text-center">
                            <div id="resultContent">
                                <!-- Result content will be loaded here -->
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-center">
                        <button class="btn btn-info btn-custom me-2" onclick="showReview()">
                            <i class="fas fa-eye me-2"></i>Review Answers
                        </button>
                        <button class="btn btn-success btn-custom me-2" onclick="generateCompletePDF()">
                            <i class="fas fa-download me-2"></i>Save Complete Report as PDF
                        </button>
                        <button class="retake-btn" onclick="retakeTest()">
                            <i class="fas fa-redo me-2"></i>Retake Test
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Review Modal -->
        <div class="modal fade" id="reviewModal" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-clipboard-list me-2"></i>Answer Review</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                        <div id="reviewContent">
                            <!-- Review content will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-dark text-white text-center py-3 mt-5">
            <p class="mb-0">© 2025 Copyright UOS Mock Test Series Powered By Mock Test Hub</p>
        </footer>
    </div>

    <!-- Theme Toggle Floating Button -->
    <button class="btn btn-primary floating-btn d-none d-md-block" onclick="toggleTheme()" title="Toggle Theme">
        <i class="fas fa-adjust"></i>
    </button>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        // Global Variables
        let currentQuestion = 1;
        let totalQuestions = 100;
        let answers = {};
        let flaggedQuestions = new Set();
        let timeRemaining = 90 * 60; // 90 minutes in seconds
        let timerInterval;
        let testStartTime;
        let testEndTime;
        let currentTheme = 'light';

        // MathJax Configuration
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                ignoreHtmlClass: "tex2jax_ignore",
                processHtmlClass: "tex2jax_process"
            },
            startup: {
                pageReady: () => {
                    console.log("MathJax is ready");
                    // Render any existing math when page is ready
                    return MathJax.startup.defaultPageReady();
                }
            }
        };

        // Check if required libraries are loaded
        function checkLibraries() {
            let allLoaded = true;
            
            if (typeof window.jspdf === 'undefined' || typeof window.jspdf.jsPDF === 'undefined') {
                console.error('jsPDF library not loaded');
                allLoaded = false;
            } else {
                console.log('jsPDF library loaded successfully');
            }
            
            if (typeof window.html2canvas === 'undefined') {
                console.error('html2canvas library not loaded');
                allLoaded = false;
            } else {
                console.log('html2canvas library loaded successfully');
            }
            
            return allLoaded;
        }
        
        // Test PDF Generation (for debugging)
        function testPDFGeneration() {
            console.log('Testing PDF generation libraries...');
            
            if (!checkLibraries()) {
                alert('Required libraries are not loaded. Please check the console for details.');
                return;
            }
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                doc.text('Test PDF generation successful!', 10, 10);
                doc.save('test.pdf');
                console.log('Test PDF generated successfully');
                alert('Test PDF generated successfully! Check your downloads folder.');
            } catch (error) {
                console.error('Error in test PDF generation:', error);
                alert('Error in test PDF generation: ' + error.message);
            }
        }
        
        // Exact 100 Questions Data - Section-wise organized as provided
       const questionsData = {
  "English": [
   {
    "id": 1,
    "subject": "English",
    "topic": "Vocabulary",
    "question": "1. Antonym of SUCCESS is __________?",
    "options": ["A. Failure", "B. Progress", "C. Victory", "D. Achievement"],
    "correct": 0
  },
  {
    "id": 2,
    "subject": "English",
    "topic": "Spelling",
    "question": "2. Choose the correctly spelled word:",
    "options": ["A. Occassion", "B. Occasion", "C. Ocasion", "D. Occassionn"],
    "correct": 1
  },
  {
    "id": 3,
    "subject": "English",
    "topic": "Vocabulary",
    "question": "3. The word 'benevolent' means?",
    "options": ["A. Kind", "B. Angry", "C. Cruel", "D. Harsh"],
    "correct": 0
  },
  {
    "id": 4,
    "subject": "English",
    "topic": "Voice",
    "question": "4. Passive voice of: 'They are writing a letter'?",
    "options": [
      "A. A letter is written by them",
      "B. A letter was written by them",
      "C. A letter is being written by them",
      "D. A letter has been written by them"
    ],
    "correct": 2
  },
  {
    "id": 5,
    "subject": "English",
    "topic": "Prepositions",
    "question": "5. Fill in the blank: He is good _____ mathematics.",
    "options": ["A. in", "B. at", "C. on", "D. for"],
    "correct": 1
  },
  {
    "id": 6,
    "subject": "English",
    "topic": "Vocabulary",
    "question": "6. Choose the synonym of 'Rapid':",
    "options": ["A. Slow", "B. Quick", "C. Late", "D. Weak"],
    "correct": 1
  },
  {
    "id": 7,
    "subject": "English",
    "topic": "Grammar",
    "question": "7. Identify the correct sentence:",
    "options": [
      "A. He do not like tea",
      "B. He does not likes tea",
      "C. He does not like tea",
      "D. He not like tea"
    ],
    "correct": 2
  },
  {
    "id": 8,
    "subject": "English",
    "topic": "Vocabulary",
    "question": "8. Antonym of 'Joy' is?",
    "options": ["A. Happiness", "B. Sadness", "C. Pleasure", "D. Excitement"],
    "correct": 1
  },
  {
    "id": 9,
    "subject": "English",
    "topic": "Grammar",
    "question": "9. Choose the correct article: She bought ___ orange.",
    "options": ["A. a", "B. an", "C. the", "D. no article"],
    "correct": 1
  },
  {
    "id": 10,
    "subject": "English",
    "topic": "Vocabulary",
    "question": "10. Choose the synonym of 'Ancient':",
    "options": ["A. Modern", "B. Old", "C. Recent", "D. Future"],
    "correct": 1
  },
  {
    "id": 11,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "11. The capital of Canada is?",
    "options": ["A. Toronto", "B. Ottawa", "C. Montreal", "D. Vancouver"],
    "correct": 1
  },
  {
    "id": 12,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "12. Which is the largest desert in the world?",
    "options": ["A. Sahara", "B. Gobi", "C. Kalahari", "D. Thar"],
    "correct": 0
  },
  {
    "id": 13,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "13. The currency of Japan is?",
    "options": ["A. Yuan", "B. Yen", "C. Won", "D. Ringgit"],
    "correct": 1
  },
  {
    "id": 14,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "14. The Great Wall of China was built mainly to protect from?",
    "options": ["A. Japanese", "B. Mongols", "C. Indians", "D. Russians"],
    "correct": 1
  },
  {
    "id": 15,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "15. Who invented the telephone?",
    "options": ["A. Thomas Edison", "B. Alexander Graham Bell", "C. Newton", "D. Marconi"],
    "correct": 1
  },
  {
    "id": 16,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "16. Mount Everest lies in which mountain range?",
    "options": ["A. Karakoram", "B. Himalayas", "C. Hindu Kush", "D. Andes"],
    "correct": 1
  },
  {
    "id": 17,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "17. World War II ended in which year?",
    "options": ["A. 1942", "B. 1943", "C. 1944", "D. 1945"],
    "correct": 3
  },
  {
    "id": 18,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "18. The United Nations headquarters is located in?",
    "options": ["A. Paris", "B. London", "C. New York", "D. Geneva"],
    "correct": 2
  },
  {
    "id": 19,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "19. The largest ocean in the world is?",
    "options": ["A. Atlantic", "B. Indian", "C. Pacific", "D. Arctic"],
    "correct": 2
  },
  {
    "id": 20,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "20. Which is the fastest land animal?",
    "options": ["A. Cheetah", "B. Lion", "C. Horse", "D. Tiger"],
    "correct": 0
  },
  {
    "id": 21,
    "subject": "Islamic Studies",
    "topic": "Quran",
    "question": "21. How many Surahs in the Quran start with 'Alhamdulillah'?",
    "options": ["A. 3", "B. 4", "C. 5", "D. 6"],
    "correct": 1
  },
  {
    "id": 22,
    "subject": "Islamic Studies",
    "topic": "Islamic History",
    "question": "22. The first Ghazwa of Islam was?",
    "options": ["A. Badr", "B. Uhud", "C. Tabuk", "D. Abwa"],
    "correct": 3
  },
  {
    "id": 23,
    "subject": "Islamic Studies",
    "topic": "Quran",
    "question": "23. Which Surah is known as the Heart of the Quran?",
    "options": ["A. Yaseen", "B. Rahman", "C. Ikhlas", "D. Kahf"],
    "correct": 0
  },
  {
    "id": 24,
    "subject": "Islamic Studies",
    "topic": "Islamic History",
    "question": "24. Hazrat Abu Hurairah (RA) is famous for?",
    "options": ["A. Bravery", "B. Wealth", "C. Narration of Hadith", "D. Governance"],
    "correct": 2
  },
  {
    "id": 25,
    "subject": "Islamic Studies",
    "topic": "Quran",
    "question": "25. The last Surah revealed was?",
    "options": ["A. Surah Nasr", "B. Surah Kausar", "C. Surah Fatiha", "D. Surah Ikhlas"],
    "correct": 0
  },
  {
    "id": 26,
    "subject": "Islamic Studies",
    "topic": "Islamic History",
    "question": "26. The treaty of Hudaibiya took place in?",
    "options": ["A. 5 AH", "B. 6 AH", "C. 7 AH", "D. 8 AH"],
    "correct": 1
  },
  {
    "id": 27,
    "subject": "Islamic Studies",
    "topic": "Islamic History",
    "question": "27. Who was the first Hafiz of Quran?",
    "options": ["A. Abu Bakr (RA)", "B. Ali (RA)", "C. Prophet Muhammad (PBUH)", "D. Uthman (RA)"],
    "correct": 2
  },
  {
    "id": 28,
    "subject": "Islamic Studies",
    "topic": "Pillars of Islam",
    "question": "28. Which pillar of Islam is Fasting?",
    "options": ["A. 1st", "B. 2nd", "C. 3rd", "D. 4th"],
    "correct": 2
  },
  {
    "id": 29,
    "subject": "Islamic Studies",
    "topic": "Pillars of Islam",
    "question": "29. The word 'Zakat' literally means?",
    "options": ["A. Charity", "B. Purification", "C. Donation", "D. Prayer"],
    "correct": 1
  },
  {
    "id": 30,
    "subject": "Islamic Studies",
    "topic": "Islamic History",
    "question": "30. The first Wahi was revealed in which month?",
    "options": ["A. Rajab", "B. Ramadan", "C. Shaban", "D. Safar"],
    "correct": 1
  },
  {
    "id": 31,
    "subject": "Pakistan Studies",
    "topic": "History",
    "question": "31. Pakistan became a republic in?",
    "options": ["A. 1947", "B. 1956", "C. 1962", "D. 1973"],
    "correct": 1
  },
  {
    "id": 32,
    "subject": "Pakistan Studies",
    "topic": "Culture",
    "question": "32. The National Anthem of Pakistan was composed by?",
    "options": ["A. Allama Iqbal", "B. Hafeez Jalandhari", "C. Ahmad G Chagla", "D. Josh Malihabadi"],
    "correct": 2
  },
  {
    "id": 33,
    "subject": "Pakistan Studies",
    "topic": "History",
    "question": "33. Objective Resolution was passed in?",
    "options": ["A. 1948", "B. 1949", "C. 1950", "D. 1951"],
    "correct": 1
  },
  {
    "id": 34,
    "subject": "Pakistan Studies",
    "topic": "History",
    "question": "34. The first Governor General of Pakistan was?",
    "options": ["A. Liaquat Ali Khan", "B. Muhammad Ali Jinnah", "C. Ayub Khan", "D. Nazimuddin"],
    "correct": 1
  },
  {
    "id": 35,
    "subject": "Pakistan Studies",
    "topic": "Culture",
    "question": "35. Which is the national flower of Pakistan?",
    "options": ["A. Jasmine", "B. Rose", "C. Sunflower", "D. Tulip"],
    "correct": 0
  },
  {
    "id": 36,
    "subject": "Pakistan Studies",
    "topic": "History",
    "question": "36. When did Pakistan win its first Cricket World Cup?",
    "options": ["A. 1987", "B. 1992", "C. 1996", "D. 1999"],
    "correct": 1
  },
  {
    "id": 37,
    "subject": "Pakistan Studies",
    "topic": "Culture",
    "question": "37. The national poet of Pakistan is?",
    "options": ["A. Faiz Ahmad Faiz", "B. Allama Iqbal", "C. Hafeez Jalandhari", "D. Josh Malihabadi"],
    "correct": 1
  },
  {
    "id": 38,
    "subject": "Pakistan Studies",
    "topic": "Geography",
    "question": "38. Which river is known as the lifeline of Pakistan?",
    "options": ["A. Jhelum", "B. Indus", "C. Chenab", "D. Ravi"],
    "correct": 1
  },
  {
    "id": 39,
    "subject": "Pakistan Studies",
    "topic": "Geography",
    "question": "39. Karakoram Highway connects Pakistan with?",
    "options": ["A. India", "B. China", "C. Iran", "D. Afghanistan"],
    "correct": 1
  },
  {
    "id": 40,
    "subject": "Pakistan Studies",
    "topic": "Geography",
    "question": "40. Which city is known as City of Gardens?",
    "options": ["A. Karachi", "B. Lahore", "C. Multan", "D. Peshawar"],
    "correct": 1
  },
  {
    "id": 41,
    "subject": "Mathematics",
    "topic": "Arithmetic",
    "question": "41. What is \(12 \times 8\)?",
    "options": ["A. 96", "B. 108", "C. 88", "D. 92"],
    "correct": 0
  },
  {
    "id": 42,
    "subject": "Mathematics",
    "topic": "Arithmetic",
    "question": "42. The square root of \(144\) is?",
    "options": ["A. 10", "B. 11", "C. 12", "D. 13"],
    "correct": 2
  },
  {
    "id": 43,
    "subject": "Mathematics",
    "topic": "Arithmetic",
    "question": "43. Simplify: \(25 \div 5 \times 2 = ?\)",
    "options": ["A. 5", "B. 10", "C. 15", "D. 20"],
    "correct": 1
  },
  {
    "id": 44,
    "subject": "Mathematics",
    "topic": "Geometry",
    "question": "44. If a triangle has sides \(3, 4, 5\) it is?",
    "options": ["A. Equilateral", "B. Isosceles", "C. Right-angled", "D. Scalene"],
    "correct": 2
  },
  {
    "id": 45,
    "subject": "Mathematics",
    "topic": "Percentages",
    "question": "45. What is \(15\%\) of \(200\)?",
    "options": ["A. 20", "B. 25", "C. 30", "D. 35"],
    "correct": 2
  },
  {
    "id": 46,
    "subject": "Mathematics",
    "topic": "Arithmetic",
    "question": "46. Value of \(\pi\) (pi) up to two decimal places is?",
    "options": ["A. 3.12", "B. 3.14", "C. 3.15", "D. 3.16"],
    "correct": 1
  },
  {
    "id": 47,
    "subject": "Mathematics",
    "topic": "Geometry",
    "question": "47. Perimeter of a square of side \(6\) is?",
    "options": ["A. 12", "B. 18", "C. 20", "D. 24"],
    "correct": 3
  },
  {
    "id": 48,
    "subject": "Mathematics",
    "topic": "Arithmetic",
    "question": "48. The sum of first \(10\) natural numbers is?",
    "options": ["A. 45", "B. 50", "C. 55", "D. 60"],
    "correct": 2
  },
  {
    "id": 49,
    "subject": "Mathematics",
    "topic": "Arithmetic",
    "question": "49. The average of \(5, 10, 15\) is?",
    "options": ["A. 8", "B. 9", "C. 10", "D. 12"],
    "correct": 2
  },
  {
    "id": 50,
    "subject": "Mathematics",
    "topic": "Arithmetic",
    "question": "50. What is the cube of \(7\)?",
    "options": ["A. 343", "B. 364", "C. 336", "D. 350"],
    "correct": 0
  },
  {
    "id": 51,
    "subject": "English",
    "topic": "Vocabulary",
    "question": "51. Choose the correct antonym of 'Generous':",
    "options": ["A. Kind", "B. Selfish", "C. Charitable", "D. Benevolent"],
    "correct": 1
  },
  {
    "id": 52,
    "subject": "English",
    "topic": "Spelling",
    "question": "52. Choose the correct spelling:",
    "options": ["A. Receeve", "B. Receive", "C. Recieve", "D. Receve"],
    "correct": 1
  },
  {
    "id": 53,
    "subject": "English",
    "topic": "Grammar",
    "question": "53. Which sentence is grammatically correct?",
    "options": [
      "A. She don't like apples.",
      "B. She doesn't likes apples.",
      "C. She doesn't like apples.",
      "D. She not like apples."
    ],
    "correct": 2
  },
  {
    "id": 54,
    "subject": "English",
    "topic": "Vocabulary",
    "question": "54. Choose the correct synonym of 'Eager':",
    "options": ["A. Unwilling", "B. Keen", "C. Lazy", "D. Calm"],
    "correct": 1
  },
  {
    "id": 55,
    "subject": "English",
    "topic": "Prepositions",
    "question": "55. Fill in the blank: He has been working here ______ 2010.",
    "options": ["A. Since", "B. For", "C. From", "D. By"],
    "correct": 0
  },
  {
    "id": 56,
    "subject": "English",
    "topic": "Voice",
    "question": "56. Identify the correct passive voice: 'She writes a letter.'",
    "options": [
      "A. A letter is written by her.",
      "B. A letter was written by her.",
      "C. A letter wrote by her.",
      "D. A letter is being written by her."
    ],
    "correct": 0
  },
  {
    "id": 57,
    "subject": "English",
    "topic": "Vocabulary",
    "question": "57. Choose the correct one-word substitution: 'A person who writes dictionaries'.",
    "options": ["A. Philanthropist", "B. Lexicographer", "C. Biographer", "D. Novelist"],
    "correct": 1
  },
  {
    "id": 58,
    "subject": "English",
    "topic": "Vocabulary",
    "question": "58. Choose the correct synonym of 'Courage':",
    "options": ["A. Fear", "B. Bravery", "C. Cowardice", "D. Weakness"],
    "correct": 1
  },
  {
    "id": 59,
    "subject": "English",
    "topic": "Prepositions",
    "question": "59. Fill in the blank: She is senior ____ me.",
    "options": ["A. Than", "B. To", "C. From", "D. With"],
    "correct": 1
  },
  {
    "id": 60,
    "subject": "English",
    "topic": "Idioms",
    "question": "60. Choose the correct meaning of the idiom: 'Break the ice'.",
    "options": [
      "A. To start a conversation",
      "B. To break something",
      "C. To feel cold",
      "D. To stop talking"
    ],
    "correct": 0
  },
  {
    "id": 61,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "61. Which planet is called the 'Morning Star'?",
    "options": ["A. Mars", "B. Venus", "C. Jupiter", "D. Mercury"],
    "correct": 1
  },
  {
    "id": 62,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "62. Which is the smallest continent in the world?",
    "options": ["A. Europe", "B. Australia", "C. Antarctica", "D. South America"],
    "correct": 1
  },
  {
    "id": 63,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "63. Who invented the telephone?",
    "options": [
      "A. Alexander Graham Bell",
      "B. Thomas Edison",
      "C. Nikola Tesla",
      "D. James Watt"
    ],
    "correct": 0
  },
  {
    "id": 64,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "64. Which gas do humans exhale?",
    "options": ["A. Oxygen", "B. Carbon dioxide", "C. Nitrogen", "D. Hydrogen"],
    "correct": 1
  },
  {
    "id": 65,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "65. The largest mammal in the world is?",
    "options": ["A. Elephant", "B. Blue Whale", "C. Shark", "D. Giraffe"],
    "correct": 1
  },
  {
    "id": 66,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "66. Which is the longest river in the world?",
    "options": ["A. Amazon", "B. Nile", "C. Yangtze", "D. Mississippi"],
    "correct": 1
  },
  {
    "id": 67,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "67. How many players are there in a cricket team?",
    "options": ["A. 10", "B. 11", "C. 12", "D. 9"],
    "correct": 1
  },
  {
    "id": 68,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "68. The Great Wall of China is approximately how long?",
    "options": [
      "A. 13,000 miles",
      "B. 1,300 miles",
      "C. 30,000 miles",
      "D. 300 miles"
    ],
    "correct": 0
  },
  {
    "id": 69,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "69. Which element has the chemical symbol 'O'?",
    "options": ["A. Gold", "B. Oxygen", "C. Osmium", "D. Oxide"],
    "correct": 1
  },
  {
    "id": 70,
    "subject": "General Knowledge",
    "topic": "World & History",
    "question": "70. Which animal lays eggs?",
    "options": ["A. Cow", "B. Dog", "C. Platypus", "D. Cat"],
    "correct": 2
  },
  {
    "id": 71,
    "subject": "Mathematics",
    "topic": "Arithmetic",
    "question": "71. The value of \(2^3\) is:",
    "options": ["A. 6", "B. 8", "C. 9", "D. 12"],
    "correct": 1
  },
  {
    "id": 72,
    "subject": "Mathematics",
    "topic": "Arithmetic",
    "question": "72. Simplify: \(25 \div 5 \times 2\)",
    "options": ["A. 5", "B. 10", "C. 15", "D. 20"],
    "correct": 2
  },
  {
    "id": 73,
    "subject": "Mathematics",
    "topic": "Arithmetic",
    "question": "73. The square root of \(144\) is:",
    "options": ["A. 10", "B. 11", "C. 12", "D. 13"],
    "correct": 2
  },
  {
    "id": 74,
    "subject": "Mathematics",
    "topic": "Arithmetic",
    "question": "74. Simplify: \((3 + 2) \times (4 - 1)\)",
    "options": ["A. 5", "B. 12", "C. 15", "D. 20"],
    "correct": 2
  },
  {
    "id": 75,
    "subject": "Mathematics",
    "topic": "Algebra",
    "question": "75. If \(x = 2\), then \(3x^2 = ?\)",
    "options": ["A. 6", "B. 9", "C. 12", "D. 18"],
    "correct": 2
  },
  {
    "id": 76,
    "subject": "Mathematics",
    "topic": "Arithmetic",
    "question": "76. Convert \(0.75\) into fraction:",
    "options": ["A. 3/4", "B. 2/3", "C. 1/2", "D. 5/6"],
    "correct": 0
  },
  {
    "id": 77,
    "subject": "Mathematics",
    "topic": "Geometry",
    "question": "77. What is the perimeter of a square with side \(5\) cm?",
    "options": ["A. 10 cm", "B. 15 cm", "C. 20 cm", "D. 25 cm"],
    "correct": 2
  },
  {
    "id": 78,
    "subject": "Mathematics",
    "topic": "Percentages",
    "question": "78. Simplify: \(10\%\) of \(200\)",
    "options": ["A. 10", "B. 15", "C. 20", "D. 25"],
    "correct": 2
  },
  {
    "id": 79,
    "subject": "Mathematics",
    "topic": "Arithmetic",
    "question": "79. The average of \(10\) and \(20\) is:",
    "options": ["A. 10", "B. 15", "C. 20", "D. 25"],
    "correct": 1
  },
  {
    "id": 80,
    "subject": "Mathematics",
    "topic": "Geometry",
    "question": "80. If a triangle has angles \(90^\circ, 45^\circ\), the third angle is:",
    "options": ["A. 30°", "B. 35°", "C. 45°", "D. 60°"],
    "correct": 2
  },
  {
    "id": 81,
    "subject": "Pakistan Studies",
    "topic": "History",
    "question": "81. Which agreement ended the 1965 war between India and Pakistan?",
    "options": ["A. Shimla Agreement", "B. Tashkent Agreement", "C. Delhi Pact", "D. Lucknow Pact"],
    "correct": 1
  },
  {
    "id": 82,
    "subject": "Pakistan Studies",
    "topic": "History",
    "question": "82. Who was the first Governor of Punjab after independence?",
    "options": ["A. Francis Mudie", "B. Ayub Khan", "C. Iftikhar Hussain", "D. Khawaja Nazimuddin"],
    "correct": 0
  },
  {
    "id": 83,
    "subject": "Pakistan Studies",
    "topic": "History",
    "question": "83. When was the Objectives Resolution passed?",
    "options": ["A. 1947", "B. 1948", "C. 1949", "D. 1950"],
    "correct": 2
  },
  {
    "id": 84,
    "subject": "Pakistan Studies",
    "topic": "History",
    "question": "84. Who was Pakistan's first Army Chief?",
    "options": ["A. General Ayub Khan", "B. General Frank Messervy", "C. General Muhammad Musa", "D. General Tikka Khan"],
    "correct": 1
  },
  {
    "id": 85,
    "subject": "Pakistan Studies",
    "topic": "History",
    "question": "85. When did Pakistan conduct its first nuclear test?",
    "options": ["A. 1996", "B. 1997", "C. 1998", "D. 1999"],
    "correct": 2
  },
  {
    "id": 86,
    "subject": "Pakistan Studies",
    "topic": "Geography",
    "question": "86. Which city is known as the 'City of Saints'?",
    "options": ["A. Multan", "B. Lahore", "C. Karachi", "D. Peshawar"],
    "correct": 0
  },
  {
    "id": 87,
    "subject": "Pakistan Studies",
    "topic": "History",
    "question": "87. The Pakistan Resolution was presented by?",
    "options": ["A. Allama Iqbal", "B. Liaquat Ali Khan", "C. Chaudhry Rehmat Ali", "D. A.K. Fazlul Haq"],
    "correct": 3
  },
  {
    "id": 88,
    "subject": "Pakistan Studies",
    "topic": "History",
    "question": "88. When did General Ayub Khan become President of Pakistan?",
    "options": ["A. 1956", "B. 1958", "C. 1960", "D. 1962"],
    "correct": 1
  },
  {
    "id": 89,
    "subject": "Pakistan Studies",
    "topic": "History",
    "question": "89. When did Pakistan become a republic?",
    "options": ["A. 1947", "B. 1956", "C. 1962", "D. 1973"],
    "correct": 1
  },
  {
    "id": 90,
    "subject": "Pakistan Studies",
    "topic": "History",
    "question": "90. Who was the founder of Khilafat Movement?",
    "options": ["A. Maulana Muhammad Ali Johar", "B. Allama Iqbal", "C. Liaquat Ali Khan", "D. Sir Syed Ahmed Khan"],
    "correct": 0
  },
  {
    "id": 91,
    "subject": "Islamic Studies",
    "topic": "Pillars of Islam",
    "question": "91. How many Rakats are there in Fajr prayer?",
    "options": ["A. 2", "B. 4", "C. 6", "D. 8"],
    "correct": 0
  },
  {
    "id": 92,
    "subject": "Islamic Studies",
    "topic": "Quran",
    "question": "92. Which Surah is known as the Heart of the Quran?",
    "options": ["A. Surah Yaseen", "B. Surah Rahman", "C. Surah Fatiha", "D. Surah Ikhlas"],
    "correct": 0
  },
  {
    "id": 93,
    "subject": "Islamic Studies",
    "topic": "Islamic History",
    "question": "93. Who was known as Zulfiqar among the Sahaba?",
    "options": ["A. Hazrat Abu Bakr (RA)", "B. Hazrat Umar (RA)", "C. Hazrat Ali (RA)", "D. Hazrat Usman (RA)"],
    "correct": 2
  },
  {
    "id": 94,
    "subject": "Islamic Studies",
    "topic": "Islamic History",
    "question": "94. Which Prophet was swallowed by a fish?",
    "options": ["A. Prophet Yunus (AS)", "B. Prophet Musa (AS)", "C. Prophet Isa (AS)", "D. Prophet Nuh (AS)"],
    "correct": 0
  },
  {
    "id": 95,
    "subject": "Islamic Studies",
    "topic": "Islamic History",
    "question": "95. Which battle is known as the first battle of Islam?",
    "options": ["A. Battle of Uhud", "B. Battle of Badr", "C. Battle of Khandaq", "D. Battle of Hunain"],
    "correct": 1
  },
  {
    "id": 96,
    "subject": "Islamic Studies",
    "topic": "Quran",
    "question": "96. Which Surah has no Bismillah?",
    "options": ["A. Surah Tauba", "B. Surah Rahman", "C. Surah Yaseen", "D. Surah Fatiha"],
    "correct": 0
  },
  {
    "id": 97,
    "subject": "Islamic Studies",
    "topic": "Islamic History",
    "question": "97. How many years did Prophet Muhammad (PBUH) live in Makkah after Prophethood?",
    "options": ["A. 10", "B. 12", "C. 13", "D. 15"],
    "correct": 2
  },
  {
    "id": 98,
    "subject": "Islamic Studies",
    "topic": "Islamic History",
    "question": "98. The angel of death is?",
    "options": ["A. Jibrael", "B. Israfil", "C. Mikail", "D. Izrael"],
    "correct": 3
  },
  {
    "id": 99,
    "subject": "Islamic Studies",
    "topic": "Quran",
    "question": "99. Which Surah is called Umm-ul-Kitab?",
    "options": ["A. Surah Ikhlas", "B. Surah Fatiha", "C. Surah Baqarah", "D. Surah Yaseen"],
    "correct": 1
  },
  {
    "id": 100,
    "subject": "Islamic Studies",
    "topic": "Quran",
    "question": "100. How many times is the name of Prophet Muhammad (PBUH) mentioned in the Quran?",
    "options": ["A. 2", "B. 3", "C. 4", "D. 5"],
    "correct": 2
  }

  ]

};
        const allQuestions = [];
        Object.values(questionsData).forEach(sectionQuestions => {
            allQuestions.push(...sectionQuestions);
        });
        
        // Make questionsData globally accessible
        window.questionsData = questionsData;
        window.allQuestions = allQuestions;

        // Initialize Test
        $(document).ready(function() {
            $('#passwordModal').modal('show');
            generateQuestionPalette();
            initializeTheme();
            adjustForMobile(); // Add mobile adjustments on load
            
            // Check if required libraries are loaded
            setTimeout(() => {
                if (!checkLibraries()) {
                    console.warn('Some required libraries failed to load. PDF generation may not work properly.');
                }
            }, 3000);
        });

        // Password Verification
        function verifyPassword() {
            const password = document.getElementById('passwordInput').value;
            const correctPassword = 'uostestbymk';
            
            if (password === correctPassword) {
                // Hide modal and show main content
                const passwordModal = bootstrap.Modal.getInstance(document.getElementById('passwordModal'));
                if (passwordModal) {
                    passwordModal.hide();
                }
                // Ensure main content is visible
                document.getElementById('mainContent').style.display = 'block';
                startTest();
            } else {
                document.getElementById('passwordError').textContent = 'Incorrect password. Please try again.';
                document.getElementById('passwordInput').classList.add('is-invalid');
                document.getElementById('passwordInput').value = '';
                
                // Add shake animation to indicate error
                const modalContent = document.querySelector('#passwordModal .modal-content');
                if (modalContent) {
                    modalContent.classList.add('animate__shakeX');
                    
                    // Remove animation class after it completes
                    setTimeout(() => {
                        modalContent.classList.remove('animate__shakeX');
                    }, 1000);
                }
            }
        }

        // Enter key for password
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                verifyPassword();
            }
        });

        // Start Test
        function startTest() {
            console.log("Starting test...");
            console.log("All questions:", allQuestions);
            testStartTime = new Date();
            startTimer();
            loadQuestion(1);
        }

        // Timer Functions
        function startTimer() {
            timerInterval = setInterval(function() {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    autoSubmitTest();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Change timer color when time is running out
            if (timeRemaining <= 300) { // 5 minutes
                document.getElementById('timer').style.background = 'linear-gradient(45deg, #dc3545, #c82333)';
            }
        }

        // Generate Question Palette
        function generateQuestionPalette() {
            const palette = document.getElementById('questionPalette');
            palette.innerHTML = '';
            
            for (let i = 1; i <= totalQuestions; i++) {
                const button = document.createElement('button');
                button.className = 'question-number btn d-inline-flex align-items-center justify-content-center me-2 mb-2';
                button.textContent = i;
                button.onclick = () => loadQuestion(i);
                palette.appendChild(button);
            }
        }

        // Load Question
        function loadQuestion(questionNum) {
            console.log("Loading question:", questionNum);
            if (!allQuestions || questionNum < 1 || questionNum > allQuestions.length) {
                console.error("Invalid question number:", questionNum);
                return;
            }
            currentQuestion = questionNum;
            const question = allQuestions[questionNum - 1];
            
            document.getElementById('currentQuestionNum').textContent = questionNum;
            
            // Update question content using string concatenation to avoid template string issues
            document.getElementById('questionContent').innerHTML = 
                '<h6><span class="badge bg-info me-2">' + question.subject + '</span>' + question.topic + '</h6>' +
                '<p class="lead">' + question.question + '</p>';
            
            // Update options
            let optionsHTML = '';
            question.options.forEach((option, index) => {
                const isSelected = answers[questionNum] === (index + 1) ? 'selected' : '';
                optionsHTML += '<div class="option-card ' + isSelected + '" onclick="selectOption(' + (index + 1) + ')">' +
                    option + '</div>';
            });
            document.getElementById('optionsContent').innerHTML = optionsHTML;
            
            // Update navigation buttons
            document.getElementById('prevBtn').style.display = questionNum === 1 ? 'none' : 'inline-block';
            document.getElementById('nextBtn').style.display = questionNum === totalQuestions ? 'none' : 'inline-block';
            document.getElementById('submitBtn').style.display = questionNum === totalQuestions ? 'inline-block' : 'none';
            
            // Update flag button
            const flagBtn = document.getElementById('flagBtn');
            if (flaggedQuestions.has(questionNum)) {
                flagBtn.innerHTML = '<i class="fas fa-flag me-1"></i>Unflag';
                flagBtn.className = 'btn btn-danger btn-sm';
            } else {
                flagBtn.innerHTML = '<i class="fas fa-flag me-1"></i>Flag';
                flagBtn.className = 'btn btn-warning btn-sm';
            }
            
            updateQuestionPalette();
            
            // Render MathJax with better error handling
            if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                // Use a more robust approach with retries
                let retryCount = 0;
                const maxRetries = 3;
                
                const renderMath = () => {
                    MathJax.typesetPromise().then(() => {
                        console.log('MathJax rendered successfully for question ' + questionNum);
                    }).catch(function (err) {
                        console.log('MathJax typeset error for question ' + questionNum + ': ' + err.message);
                        retryCount++;
                        if (retryCount < maxRetries) {
                            console.log('Retrying MathJax render (attempt ' + (retryCount + 1) + ')');
                            setTimeout(renderMath, 300);
                        } else {
                            console.log('Max retries reached for MathJax rendering on question ' + questionNum);
                        }
                    });
                };
                
                // Add a small delay to ensure DOM is updated before rendering
                setTimeout(renderMath, 150);
            } else {
                console.log('MathJax not available for question ' + questionNum);
            }
            
            // Add fade-in animation
            document.getElementById('questionCard').classList.add('fade-in');
            setTimeout(() => {
                document.getElementById('questionCard').classList.remove('fade-in');
            }, 500);
        }

        // Select Option
        function selectOption(optionNum) {
            answers[currentQuestion] = optionNum;
            
            // Update option display
            document.querySelectorAll('.option-card').forEach((card, index) => {
                card.classList.remove('selected');
                if (index + 1 === optionNum) {
                    card.classList.add('selected');
                }
            });
            
            updateQuestionPalette();
        }

        // Update Question Palette
        function updateQuestionPalette() {
            const buttons = document.querySelectorAll('.question-number');
            buttons.forEach((button, index) => {
                const questionNum = index + 1;
                button.classList.remove('current', 'answered', 'flagged');
                
                if (questionNum === currentQuestion) {
                    button.classList.add('current');
                } else if (answers[questionNum]) {
                    button.classList.add('answered');
                }
                
                if (flaggedQuestions.has(questionNum)) {
                    button.classList.add('flagged');
                }
            });
        }

        // Navigation Functions
        function previousQuestion() {
            if (currentQuestion > 1) {
                loadQuestion(currentQuestion - 1);
            }
        }

        function nextQuestion() {
            if (currentQuestion < totalQuestions) {
                loadQuestion(currentQuestion + 1);
            }
        }

        // Flag Question
        function toggleFlag() {
            if (flaggedQuestions.has(currentQuestion)) {
                flaggedQuestions.delete(currentQuestion);
            } else {
                flaggedQuestions.add(currentQuestion);
            }
            loadQuestion(currentQuestion);
        }

        // Submit Test
        function submitTest() {
            console.log("Submit test function called");
            if (confirm('Are you sure you want to submit the test? You cannot change your answers after submission.')) {
                console.log("User confirmed submission");
                testEndTime = new Date();
                clearInterval(timerInterval);
                calculateResults();
            } else {
                console.log("User cancelled submission");
            }
        }

        function autoSubmitTest() {
            testEndTime = new Date();
            alert('Time\'s up! Test will be submitted automatically.');
            calculateResults();
        }

        // Calculate Score
        function calculateScore(answers) {
            let score = 0;
            // We'll implement this properly when we have the questions data structure
            return score;
        }

        // Calculate Results
        function calculateResults() {
            console.log("Calculate results function called");
            let correctAnswers = 0;
            let totalAttempted = Object.keys(answers).length;
            
            allQuestions.forEach(question => {
                if (answers[question.id] === question.correct) {
                    correctAnswers++;
                }
            });
            
            const obtainedMarks = correctAnswers;
            const totalMarks = 100;
            const passingMarks = 50;
            const isPassed = obtainedMarks >= passingMarks;
            const timeTaken = Math.floor((testEndTime - testStartTime) / 1000);
            
            // Store results globally
            window.testResults = {
                obtainedMarks,
                totalMarks,
                passingMarks,
                isPassed,
                correctAnswers,
                totalAttempted,
                timeTaken,
                answers,
                flaggedQuestions: Array.from(flaggedQuestions)
            };
            
            console.log("Results calculated:", window.testResults);
            displayResults();
        }

        function displayResults() {
            const results = window.testResults;
            const minutes = Math.floor(results.timeTaken / 60);
            const seconds = results.timeTaken % 60;
            
            // Use string concatenation instead of template strings
            const resultHTML = 
                '<div class="row text-center">' +
                    '<div class="col-md-4 mb-3">' +
                        '<h2 class="display-4">' + results.obtainedMarks + '</h2>' +
                        '<p class="mb-0">Marks Obtained</p>' +
                    '</div>' +
                    '<div class="col-md-4 mb-3">' +
                        '<h2 class="display-4">' + results.totalMarks + '</h2>' +
                        '<p class="mb-0">Total Marks</p>' +
                    '</div>' +
                    '<div class="col-md-4 mb-3">' +
                        '<h2 class="display-4 ' + (results.isPassed ? 'text-success' : 'text-danger') + '">' +
                            (results.isPassed ? 'PASS' : 'FAIL') +
                        '</h2>' +
                        '<p class="mb-0">Result Status</p>' +
                    '</div>' +
                '</div>' +
                '<hr class="my-4">' +
                '<div class="row text-center">' +
                    '<div class="col-md-6">' +
                        '<h5><i class="fas fa-clock me-2"></i>Time Taken</h5>' +
                        '<p class="lead">' + minutes + ':' + seconds.toString().padStart(2, '0') + ' minutes</p>' +
                    '</div>' +
                    '<div class="col-md-6">' +
                        '<h5><i class="fas fa-percentage me-2"></i>Percentage</h5>' +
                        '<p class="lead">' + results.obtainedMarks + '%</p>' +
                    '</div>' +
                '</div>';
            
            document.getElementById('resultContent').innerHTML = resultHTML;
            
            // Ensure Bootstrap modal is properly initialized and shown
            const resultModal = new bootstrap.Modal(document.getElementById('resultModal'));
            resultModal.show();
            
            console.log("Result modal should be shown now");
        }

        // Retake Test Function
        function retakeTest() {
            if (confirm('Are you sure you want to retake the test? This will reset all your current answers.')) {
                // Reset all test variables
                currentQuestion = 1;
                answers = {};
                flaggedQuestions = new Set();
                timeRemaining = 90 * 60; // Reset to 90 minutes
                
                // Clear timer
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
                
                // Hide result modal
                const resultModal = bootstrap.Modal.getInstance(document.getElementById('resultModal'));
                if (resultModal) {
                    resultModal.hide();
                }
                
                // Reset UI
                generateQuestionPalette();
                
                // Start fresh test
                setTimeout(() => {
                    startTest();
                }, 500);
            }
        }

        // Show Review
        function showReview() {
            const results = window.testResults;
            let reviewHTML = '';
            
            // Generate review content section-wise
            const sectionOrder = ['English', 'General Knowledge', 'General Science', 'Mathematics', 'I.Q'];
            
            for (const sectionName of sectionOrder) {
                // Skip if section doesn't exist in questionsData
                if (!questionsData[sectionName]) {
                    console.warn(`Section "${sectionName}" not found in questionsData`);
                    continue;
                }
                
                const sectionQuestions = questionsData[sectionName];
                
                // Section Header
                reviewHTML += `
                    <div class="mb-4">
                        <h4 class="text-primary border-bottom pb-2">
                            <i class="fas fa-book-open me-2"></i>${sectionName}
                        </h4>
                `;
                
                sectionQuestions.forEach(question => {
                    const userAnswer = results.answers[question.id];
                    const isCorrect = userAnswer === question.correct;
                    const isAttempted = userAnswer !== undefined;
                    
                    let statusClass, statusIcon, statusText;
                    if (!isAttempted) {
                        statusClass = 'review-unattempted';
                        statusIcon = 'fas fa-minus-circle text-secondary';
                        statusText = 'Not Attempted';
                    } else if (isCorrect) {
                        statusClass = 'review-correct';
                        statusIcon = 'fas fa-check-circle text-success';
                        statusText = 'Correct';
                    } else {
                        statusClass = 'review-incorrect';
                        statusIcon = 'fas fa-times-circle text-danger';
                        statusText = 'Incorrect';
                    }
                    
                    reviewHTML += `
                        <div class="card mb-3 ${statusClass}">
                            <div class="card-header">
                                <div class="row align-items-center">
                                    <div class="col-md-6">
                                        <h6 class="mb-0">Question ${question.id}</h6>
                                        <small class="text-muted">${question.topic}</small>
                                    </div>
                                    <div class="col-md-6 text-md-end">
                                        <span class="badge bg-secondary">
                                            <i class="${statusIcon} me-1"></i>${statusText}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <p><strong>Question:</strong> ${question.question}</p>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Your Answer:</strong> 
                                            ${userAnswer ? question.options[userAnswer - 1] : 'Not Attempted'}
                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Correct Answer:</strong> 
                                            ${question.options[question.correct - 1]}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                reviewHTML += '</div>'; // Close section
            }
            
            document.getElementById('reviewContent').innerHTML = reviewHTML;
            
            // Show review modal using Bootstrap JS
            const reviewModal = new bootstrap.Modal(document.getElementById('reviewModal'));
            reviewModal.show();
            
            // Render MathJax for review
            if (window.MathJax) {
                MathJax.typesetPromise().catch(function (err) {
                    console.log('MathJax typeset error in review: ' + err.message);
                });
            }
        }

                // Complete PDF Generation - WITHOUT Question Palette
        async function generateCompletePDF() {
            // Show progress modal
            document.getElementById('pdfProgress').style.display = 'flex';
            updateProgress(0, 'Initializing PDF generation...');
            
            try {
                console.log('Starting PDF generation...');
                
                // Check if required libraries are loaded
                if (!checkLibraries()) {
                    throw new Error('Required libraries (jsPDF, html2canvas) are not loaded properly. Please refresh the page and try again.');
                }
                
                // Check if jsPDF is properly loaded
                if (!window.jspdf || !window.jspdf.jsPDF) {
                    throw new Error('jsPDF library not loaded properly. Please refresh the page and try again.');
                }
                
                const { jsPDF } = window.jspdf;
                
                // Test if we can create a jsPDF instance
                let doc;
                try {
                    doc = new jsPDF('p', 'mm', 'a4');
                    console.log('jsPDF instance created successfully');
                } catch (pdfError) {
                    throw new Error('Failed to create PDF document: ' + pdfError.message);
                }
                
                // Check if test results are available
                if (!window.testResults) {
                    throw new Error('Test results not available. Please complete the test first.');
                }
                
                // Check if questions data is available
                if (!window.questionsData) {
                    throw new Error('Questions data not available. Please refresh the page and try again.');
                }
                
                const results = window.testResults;
                console.log('Test results available:', results);
                
                const obtainedMarks = results.obtainedMarks;
                const totalMarks = results.totalMarks;
                const percentage = obtainedMarks;
                const grade = obtainedMarks >= 50 ? 'Pass' : 'Fail';
                const remarks = obtainedMarks >= 80 ? 'Excellent!' : 
                               obtainedMarks >= 70 ? 'Very Good' : 
                               obtainedMarks >= 60 ? 'Good' : 
                               obtainedMarks >= 50 ? 'Satisfactory' : 'Needs Improvement';
                
                // REMOVED the sections object that contained empty data that was showing in the PDF
                // const sections = {
                //     'English': { totalMarks: 30, obtainedMarks: 0, percentage: 0, grade: '', remarks: '' },
                //     'General Knowledge': { totalMarks: 20, obtainedMarks: 0, percentage: 0, grade: '', remarks: '' },
                //     'General Science': { totalMarks: 20, obtainedMarks: 0, percentage: 0, grade: '', remarks: '' },
                //     'Mathematics': { totalMarks: 20, obtainedMarks: 0, percentage: 0, grade: '', remarks: '' },
                //     'I.Q': { totalMarks: 10, obtainedMarks: 0, percentage: 0, grade: '', remarks: '' }
                // };
                
                // REMOVED the sectionNames variable that was not being used
                // const sectionNames = ['English', 'General Knowledge', 'General Science', 'Mathematics', 'I.Q'];
                
                const questionsData = window.questionsData;
                console.log('Questions data available:', questionsData);
                
                const pageWidth = doc.internal.pageSize.width;
                const pageHeight = doc.internal.pageSize.height;
                const margin = 15;
                const lineHeight = 6;
                let yPos = margin;
                
                // Helper function to add new page
                function addNewPage() {
                    doc.addPage();
                    yPos = margin + 10;
                }
                
                // Helper function to check page overflow
                function checkPageOverflow(requiredSpace = 25) {
                    if (yPos + requiredSpace > pageHeight - margin) {
                        addNewPage();
                        return true;
                    }
                    return false;
                }
                
                // Helper function to clean LaTeX for plain text
                function cleanLatexText(text) {
                    if (!text) return '';
                    return text
                        .replace(/\\\(/g, '')
                        .replace(/\\\)/g, '')
                        .replace(/\\\[/g, '')
                        .replace(/\\\]/g, '')
                        .replace(/\\frac\{([^}]+)\}\{([^}]+)\}/g, '($1)/($2)')
                        .replace(/\\sqrt\{([^}]+)\}/g, 'sqrt($1)')
                        .replace(/\\pi/g, 'π')
                        .replace(/\\theta/g, 'θ')
                        .replace(/\\alpha/g, 'α')
                        .replace(/\\beta/g, 'β')
                        .replace(/\\gamma/g, 'γ')
                        .replace(/\\delta/g, 'δ')
                        .replace(/\\epsilon/g, 'ε')
                        .replace(/\\phi/g, 'φ')
                        .replace(/\\lambda/g, 'λ')
                        .replace(/\\mu/g, 'μ')
                        .replace(/\\sigma/g, 'σ')
                        .replace(/\\omega/g, 'ω')
                        .replace(/\\Omega/g, 'Ω')
                        .replace(/\\times/g, '×')
                        .replace(/\\cdot/g, '·')
                        .replace(/\\rightarrow/g, '→')
                        .replace(/\\leftarrow/g, '←')
                        .replace(/\\rightleftharpoons/g, '⇌')
                        .replace(/\\infty/g, '∞')
                        .replace(/\\pm/g, '±')
                        .replace(/\\leq/g, '≤')
                        .replace(/\\geq/g, '≥')
                        .replace(/\\neq/g, '≠')
                        .replace(/\\approx/g, '≈')
                        .replace(/\\int/g, '∫')
                        .replace(/\\sum/g, 'Σ')
                        .replace(/\\prod/g, 'Π')
                        .replace(/\\lim/g, 'lim')
                        .replace(/\\log/g, 'log')
                        .replace(/\\ln/g, 'ln')
                        .replace(/\\sin/g, 'sin')
                        .replace(/\\cos/g, 'cos')
                        .replace(/\\tan/g, 'tan')
                        .replace(/\\mathbb\{([^}]+)\}/g, '$1')
                        .replace(/\\setminus/g, '\\')
                        .replace(/\\\\/g, ' ')
                        .replace(/\\text\{([^}]+)\}/g, '$1')
                        .replace(/\\[a-zA-Z]+/g, '')
                        .replace(/[{}]/g, '')
                        .replace(/\s+/g, ' ')
                        .trim();
                }
                
                updateProgress(5, 'Creating header...');
                
                // Header Section
                doc.setFillColor(102, 126, 234);
                doc.rect(0, 0, pageWidth, 50, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.setFont('helvetica', 'bold');
                doc.text('UOS Mock Test Batch 2k26 - Test 3', margin, 20);
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'normal');
                doc.text('Academic Test Results Report', margin, 32);
                
                doc.setFontSize(10);
                doc.text(`Generated on: ${new Date().toLocaleString()}`, margin, 42);
                
                yPos = 60;
                doc.setTextColor(0, 0, 0);
                
                updateProgress(10, 'Adding result summary...');
                
                // Results Summary Section - REMOVED the section data that was showing empty values
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(102, 126, 234);
                doc.text('TEST RESULTS SUMMARY', margin, yPos);
                
                yPos += 20;
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(0, 0, 0);
                doc.text(`Total Marks: ${totalMarks}`, margin, yPos);
                yPos += 10;
                doc.text(`Obtained Marks: ${obtainedMarks}`, margin, yPos);
                yPos += 10;
                doc.text(`Percentage: ${percentage.toFixed(2)}%`, margin, yPos);
                yPos += 10;
                doc.text(`Grade: ${grade}`, margin, yPos);
                yPos += 10;
                doc.text(`Remarks: ${remarks}`, margin, yPos);
                yPos += 20;
                
                updateProgress(40, 'Adding question details...');
                
                yPos += 15;
                
                // Summary box
                doc.setDrawColor(102, 126, 234);
                doc.setLineWidth(0.5);
                doc.rect(margin, yPos, pageWidth - 2 * margin, 55);
                
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(0, 0, 0);
                
                const minutes = Math.floor(results.timeTaken / 60);
                const seconds = results.timeTaken % 60;
                
                const summaryInfo = [
                    `Marks Obtained: ${results.obtainedMarks}/${results.totalMarks}`,
                    `Percentage: ${results.obtainedMarks}%`,
                    `Result Status: ${results.isPassed ? 'PASS' : 'FAIL'}`,
                    `Time Taken: ${minutes}:${seconds.toString().padStart(2, '0')} minutes`,
                    `Questions Attempted: ${results.totalAttempted}/100`,
                    `Correct Answers: ${results.correctAnswers}`,
                    `Incorrect Answers: ${results.totalAttempted - results.correctAnswers}`,
                    `Unattempted: ${100 - results.totalAttempted}`
                ];
                
                // Better alignment for summary information
                summaryInfo.forEach((info, index) => {
                    const x = (index % 2 === 0) ? margin + 10 : (pageWidth / 2) + 5;
                    const y = yPos + 15 + Math.floor(index / 2) * 12;
                    doc.text(info, x, y);
                });
                
                yPos += 65;
                checkPageOverflow();
                
                updateProgress(15, 'Creating section-wise question analysis...');
                
                // Section-wise Question Analysis
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(102, 126, 234);
                doc.text('DETAILED SECTION-WISE ANALYSIS', margin, yPos);
                yPos += 20; // Increased spacing after section title
                
                // Process sections in order
                const sectionOrder = ['English', 'General Knowledge', 'General Science', 'Mathematics', 'I.Q'];
                let questionCounter = 0;
                
                // Log available sections for debugging
                console.log('Available sections:', Object.keys(questionsData));
                
                for (const sectionName of sectionOrder) {
                    // Skip if section doesn't exist in questionsData
                    if (!questionsData[sectionName]) {
                        console.warn(`Section "${sectionName}" not found in questionsData. Available sections:`, Object.keys(questionsData));
                        continue;
                    }
                    
                    const sectionQuestions = questionsData[sectionName];
                    
                    // Update progress
                    const sectionProgress = 15 + Math.floor((questionCounter / 100) * 70);
                    updateProgress(sectionProgress, `Processing ${sectionName} section...`);
                    
                    // Check if we need a new page for section header
                    checkPageOverflow(20);
                    
                    // Section Header
                    doc.setFillColor(52, 58, 64);
                    // Improved sizing and positioning for section headers
                    doc.rect(margin, yPos - 3, pageWidth - 2 * margin, 15, 'F');
                    
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(14);
                    doc.setFont('helvetica', 'bold');
                    // Better vertical alignment for section headers
                    doc.text(`${sectionName.toUpperCase()}`, margin + 5, yPos + 4);
                    
                    doc.setTextColor(0, 0, 0);
                    yPos += 20; // Increased spacing after section header
                    
                    // Process questions in this section
                    for (const question of sectionQuestions) {
                        const userAnswer = results.answers[question.id];
                        const isCorrect = userAnswer === question.correct;
                        const isAttempted = userAnswer !== undefined;
                        
                        questionCounter++;
                        
                        // Check if we need a new page
                        checkPageOverflow(40);
                        
                        // Question header
                        doc.setFillColor(248, 249, 250);
                        doc.rect(margin, yPos - 3, pageWidth - 2 * margin, 15, 'F');
                        
                        doc.setFontSize(11);
                        doc.setFont('helvetica', 'bold');
                        doc.setTextColor(0, 0, 0);
                        doc.text(`Q${question.id}. ${question.topic}`, margin + 5, yPos + 2);
                        
                        // Status badge
                        let statusColor, statusText;
                        if (!isAttempted) {
                            statusColor = [108, 117, 125];
                            statusText = 'NOT ATTEMPTED';
                        } else if (isCorrect) {
                            statusColor = [25, 135, 84];
                            statusText = 'CORRECT';
                        } else {
                            statusColor = [220, 53, 69];
                            statusText = 'INCORRECT';
                        }
                        
                        doc.setFillColor(statusColor[0], statusColor[1], statusColor[2]);
                        const statusWidth = doc.getTextWidth(statusText) + 10;
                        doc.rect(pageWidth - margin - statusWidth, yPos - 3, statusWidth, 15, 'F');
                        doc.setTextColor(255, 255, 255);
                        doc.setFontSize(8);
                        doc.text(statusText, pageWidth - margin - statusWidth + 5, yPos + 3);
                        
                        yPos += 18; // Increased spacing after question header
                        
                        // Question text
                        doc.setTextColor(0, 0, 0);
                        doc.setFontSize(10);
                        doc.setFont('helvetica', 'normal');
                        
                        const questionText = cleanLatexText(question.question);
                        const questionLines = doc.splitTextToSize(questionText, pageWidth - 2 * margin - 15);
                        
                        questionLines.forEach((line, index) => {
                            checkPageOverflow(8);
                            doc.text(line, margin + 8, yPos + 1);
                            yPos += lineHeight + 1;
                        });
                        
                        yPos += 8; // Increased spacing after question text to prevent overlapping
                        
                        // Options
                        question.options.forEach((option, optIndex) => {
                            checkPageOverflow(15); // Increased overflow check spacing
                            
                            const isSelected = userAnswer === (optIndex + 1);
                            const isCorrectOption = optIndex === question.correct;
                            
                            // Calculate option text height first to properly size containers
                            const optionText = cleanLatexText(option);
                            const optionLines = doc.splitTextToSize(optionText, pageWidth - 2 * margin - 20);
                            const optionHeight = (optionLines.length * lineHeight) + 4;
                            
                            // Highlight correct options with green background (always visible)
                            // Also highlight user's selections
                            if (isCorrectOption) {
                                // Always highlight correct answers with green background
                                // Using a lighter green to simulate transparency since we can't use setFillAlpha
                                doc.setFillColor(192, 224, 207); // Light green color
                                doc.rect(margin + 5, yPos - 2, pageWidth - 2 * margin - 10, optionHeight, 'F');
                            } else if (isSelected) {
                                // Highlight incorrect user selections with red background
                                // Using a lighter red to simulate transparency since we can't use setFillAlpha
                                doc.setFillColor(240, 200, 205); // Light red color
                                doc.rect(margin + 5, yPos - 2, pageWidth - 2 * margin - 10, optionHeight, 'F');
                            }
                            
                            // Reset to default after drawing
                            doc.setFillColor(0);
                            
                            // Make correct answers bold for better visibility
                            doc.setFont('helvetica', isCorrectOption ? 'bold' : (isSelected ? 'bold' : 'normal'));
                            
                            // No symbols as requested
                            optionLines.forEach((line, lineIndex) => {
                                if (lineIndex > 0) checkPageOverflow(8);
                                // Proper vertical alignment with calculated positioning
                                doc.text(line, margin + 10, yPos + 2);
                                yPos += lineHeight;
                            });
                            
                            // Add spacing after each option to prevent overlapping
                            yPos += 3;
                        });
                        
                        yPos += 10; // Consistent spacing after options section
                    }
                    
                    yPos += 10; // Increased spacing between sections
                }
                
                updateProgress(95, 'Finalizing PDF...');
                
                // Footer on last page
                yPos = pageHeight - 20;
                doc.setFontSize(8);
                doc.setTextColor(128, 128, 128);
                doc.setFont('helvetica', 'normal');
                doc.text('© 2025 Copyright UOS Mock Test Series Powered By Mock Test Hub', margin, yPos);
                doc.text(`Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}`, margin, yPos + 5);
                
                updateProgress(100, 'Download starting...');
                
                // Save the PDF
                const fileName = `UOS_Academic_Mock_Test_Complete_Report_${new Date().getTime()}.pdf`;
                doc.save(fileName);
                
                // Hide progress modal after a short delay
                setTimeout(() => {
                    document.getElementById('pdfProgress').style.display = 'none';

                }, 1000);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                document.getElementById('pdfProgress').style.display = 'none';
                let errorMessage = 'An error occurred while generating the PDF. ';
                
                // Provide more specific error messages based on the error type
                if (error.message.includes('library')) {
                    errorMessage += 'Please refresh the page and try again. If the problem persists, check your internet connection.';
                } else if (error.message.includes('results')) {
                    errorMessage += 'Please complete the test first before generating a report.';
                } else if (error.message.includes('sectionName')) {
                    errorMessage += 'There was an issue with the section data. Please try again.';
                } else {
                    errorMessage += 'Please try again. Error details: ' + error.message;
                }
                
                // Only show alert in development, remove for production
                console.log('PDF Error: ' + errorMessage);
            }
        }
        
        // Update progress function
        function updateProgress(percentage, text) {
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = text;
        }

        // Theme Toggle
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            
            const themeIcon = document.querySelector('#themeToggle i');
            if (currentTheme === 'dark') {
                themeIcon.className = 'fas fa-sun';
            } else {
                themeIcon.className = 'fas fa-moon';
            }
            
            localStorage.setItem('theme', currentTheme);
        }

        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            currentTheme = savedTheme;
            document.documentElement.setAttribute('data-theme', currentTheme);
            
            const themeIcon = document.querySelector('#themeToggle i');
            if (currentTheme === 'dark') {
                themeIcon.className = 'fas fa-sun';
            } else {
                themeIcon.className = 'fas fa-moon';
            }
        }

        // Initialize Test
        $(document).ready(function() {
            // Initially hide main content and show password modal
            $('#mainContent').hide();
            $('#passwordModal').modal('show');
            generateQuestionPalette();
            initializeTheme();
            
            // Check if required libraries are loaded
            setTimeout(() => {
                if (!checkLibraries()) {
                    console.warn('Some required libraries failed to load. PDF generation may not work properly.');
                }
            }, 3000);
        });

        // Mobile responsive adjustments
        function adjustForMobile() {
            const isMobile = window.innerWidth <= 768;
            
            // Adjust question palette for mobile
            const questionPalette = document.getElementById('questionPalette');
            if (questionPalette) {
                if (isMobile) {
                    questionPalette.style.padding = '6px';
                } else {
                    questionPalette.style.padding = '10px';
                }
            }
            
            // Adjust option cards for mobile
            const optionCards = document.querySelectorAll('.option-card');
            optionCards.forEach(card => {
                if (isMobile) {
                    card.style.padding = '12px 15px';
                    card.style.margin = '6px 0';
                } else {
                    card.style.padding = '15px 20px';
                    card.style.margin = '10px 0';
                }
            });
        }

        // Initialize mobile adjustments
        window.addEventListener('resize', adjustForMobile);
        window.addEventListener('load', adjustForMobile);

        // Keyboard Navigation
        document.addEventListener('keydown', function(e) {
            if ($('#passwordModal').hasClass('show')) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    if (currentQuestion > 1) previousQuestion();
                    break;
                case 'ArrowRight':
                    if (currentQuestion < totalQuestions) nextQuestion();
                    break;
                case '1':
                case '2':
                case '3':
                case '4':
                    if (!e.ctrlKey && !e.altKey) {
                        selectOption(parseInt(e.key));
                    }
                    break;
                case 'f':
                case 'F':
                    if (!e.ctrlKey && !e.altKey) {
                        toggleFlag();
                    }
                    break;
            }
        });

        // Prevent right-click and keyboard shortcuts
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && (e.key === 'u' || e.key === 's' || e.key === 'a' || e.key === 'p')) {
                e.preventDefault();
            }
            if (e.key === 'F12') {
                e.preventDefault();
            }
        });

        // Prevent text selection
        document.addEventListener('selectstart', e => e.preventDefault());

        // Auto-save functionality
        setInterval(function() {
            if (Object.keys(answers).length > 0) {
                localStorage.setItem('mockTestAnswers', JSON.stringify(answers));
                localStorage.setItem('mockTestFlagged', JSON.stringify(Array.from(flaggedQuestions)));
            }
        }, 30000); // Auto-save every 30 seconds
    </script>
</body>
</html>
        // Prevent text selection
        document.addEventListener('selectstart', e => e.preventDefault());

        // Auto-save functionality
        setInterval(function() {
            if (Object.keys(answers).length > 0) {
                localStorage.setItem('mockTestAnswers', JSON.stringify(answers));
                localStorage.setItem('mockTestFlagged', JSON.stringify(Array.from(flaggedQuestions)));
            }
        }, 30000); // Auto-save every 30 seconds
    </script>
</body>
</html>