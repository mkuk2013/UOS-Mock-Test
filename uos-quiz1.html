<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UOS Mock Test Batch 2k26 - Test 1</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <script src="https://tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #0dcaf0;
            --light-color: #f8f9fa;
            --dark-color: #212529;
        }

        [data-theme="dark"] {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #0dcaf0;
            --light-color: #212529;
            --dark-color: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light-color);
            color: var(--dark-color);
            transition: all 0.3s ease;
        }

        [data-theme="dark"] body {
            background: var(--dark-color);
            color: var(--light-color);
        }

        .header-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        [data-theme="dark"] .header-gradient {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        }

        .question-palette {
            max-height: 80px;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            margin-top: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.03);
            border-radius: 8px;
        }

        [data-theme="dark"] .question-palette {
            background: rgba(255,255,255,0.1);
        }

        .question-number {
            min-width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            background: white;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 3px;
            font-weight: 500;
        }

        [data-theme="dark"] .question-number {
            background: #495057;
            color: white;
            border-color: #6c757d;
        }

        .question-number:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .question-number.current {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: bold;
            transform: scale(1.1);
        }

        .question-number.answered {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        .question-number.flagged {
            background: var(--warning-color);
            color: black;
            border-color: var(--warning-color);
        }

        .question-number.flagged.answered {
            background: var(--info-color);
            color: white;
            border-color: var(--info-color);
        }

        .timer {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .option-card {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px 20px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            position: relative;
        }

        [data-theme="dark"] .option-card {
            background: #495057;
            border-color: #6c757d;
            color: white;
        }

        .option-card:hover {
            border-color: var(--primary-color);
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(13, 110, 253, 0.2);
        }

        .option-card.selected {
            border-color: var(--primary-color);
            background: rgba(13, 110, 253, 0.1);
            font-weight: 500;
        }

        .btn-custom {
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
            margin: 5px;
        }

        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .result-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .review-correct {
            background: rgba(25, 135, 84, 0.1);
            border-left: 4px solid var(--success-color);
        }

        .review-incorrect {
            background: rgba(220, 53, 69, 0.1);
            border-left: 4px solid var(--danger-color);
        }

        .review-unattempted {
            background: rgba(108, 117, 125, 0.1);
            border-left: 4px solid var(--secondary-color);
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .MathJax { font-size: 1.1em !important; }
        .question-content .MathJax { font-size: 1.2em !important; }

        .pdf-progress {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; justify-content: center;
            align-items: center; z-index: 9999;
        }

        .pdf-progress-content {
            background: white; padding: 30px; border-radius: 15px; text-align: center;
            max-width: 400px; width: 90%;
        }

        .progress-bar-custom {
            width: 100%; height: 20px; background: #e9ecef; border-radius: 10px;
            overflow: hidden; margin: 20px 0;
        }

        .progress-fill {
            height: 100%; background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%; transition: width 0.3s ease;
        }

        .retake-btn {
            background: linear-gradient(45deg, #28a745, #20c997); color: white; border: none;
            padding: 15px 35px; border-radius: 30px; font-size: 16px; font-weight: 600;
            text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
            transition: all 0.3s ease;
        }

        .retake-btn:hover {
            transform: translateY(-3px); box-shadow: 0 10px 30px rgba(40, 167, 69, 0.6);
            background: linear-gradient(45deg, #218838, #1e7e34);
        }

        @media (max-width: 768px) {
            .question-palette { max-height: 60px; }
            .question-number { min-width: 35px; height: 35px; font-size: 12px; }
            .timer { font-size: 14px; padding: 8px 16px; }
            .MathJax { font-size: 1em !important; }
            .card-footer .btn-custom, .modal-footer .btn-custom, .modal-footer .retake-btn { width: 100%; margin: 5px 0; }
            .text-md-end { text-align: center !important; }
        }
    </style>
</head>
<body>
    <div class="pdf-progress" id="pdfProgress">
        <div class="pdf-progress-content">
            <h4><i class="fas fa-file-pdf text-danger me-2"></i>Generating PDF Report</h4>
            <div class="progress-bar-custom">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="progressText">Preparing document...</p>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <div class="modal fade" id="passwordModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-lock me-2"></i>Secure Access Required</h5>
                </div>
                <div class="modal-body text-center">
                    <div class="mb-4">
                        <i class="fas fa-shield-alt fa-3x text-primary mb-3"></i>
                        <h6>Enter Password to Access Test</h6>
                    </div>
                    <input type="password" class="form-control text-center" id="passwordInput" placeholder="Enter Password" maxlength="20">
                    <div class="invalid-feedback" id="passwordError"></div>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-primary btn-custom" onclick="verifyPassword()">
                        <i class="fas fa-key me-2"></i>Access Test
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="mainContent" style="display: none;">
        <header class="header-gradient text-white py-4 shadow-lg">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="h3 mb-0"><i class="fas fa-graduation-cap me-2"></i>UOS Mock Test Batch 2k26 - Test 1</h1>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <div class="d-flex align-items-center justify-content-md-end justify-content-center gap-3">
                            <div class="timer" id="timer">90:00</div>
                            <button class="btn btn-outline-light btn-sm" onclick="toggleTheme()" id="themeToggle">
                                <i class="fas fa-moon"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="container my-4">
            <div class="card shadow-lg border-0" id="questionCard">
                <div class="card-header bg-primary text-white">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h5 class="mb-0">Question <span id="currentQuestionNum">1</span> of 100</h5>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <button class="btn btn-warning btn-sm" onclick="toggleFlag()" id="flagBtn">
                                <i class="fas fa-flag me-1"></i>Flag
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    <div id="questionContent" class="question-content"></div>
                    <div id="optionsContent" class="mt-4"></div>
                </div>
                <div class="card-footer">
                    <div class="row">
                        <div class="col-md-6">
                            <button class="btn btn-secondary btn-custom" onclick="previousQuestion()" id="prevBtn">
                                <i class="fas fa-chevron-left me-2"></i>Previous
                            </button>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <button class="btn btn-primary btn-custom" onclick="nextQuestion()" id="nextBtn">
                                Next<i class="fas fa-chevron-right ms-2"></i>
                            </button>
                            <button class="btn btn-success btn-custom" onclick="submitTest()" id="submitBtn" style="display: none;">
                                <i class="fas fa-paper-plane me-2"></i>Submit
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <div class="container-fluid bg-light py-3 mt-4" data-theme-bg="secondary">
            <div class="container">
                <h6 class="mb-2"><i class="fas fa-list-ol me-2"></i>Question Palette</h6>
                <div class="question-palette" id="questionPalette"></div>
            </div>
        </div>

        <div class="modal fade" id="resultModal" tabindex="-1" data-bs-backdrop="static">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title"><i class="fas fa-trophy me-2"></i>Test Results</h5>
                    </div>
                    <div class="modal-body">
                        <div class="result-card text-center">
                            <div id="resultContent"></div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-center">
                        <button class="btn btn-info btn-custom" onclick="showReview()"><i class="fas fa-eye me-2"></i>Review</button>
                        <button class="btn btn-success btn-custom" onclick="generateCompletePDF()"><i class="fas fa-download me-2"></i>Save PDF</button>
                        <button class="retake-btn" onclick="retakeTest()"><i class="fas fa-redo me-2"></i>Retake Test</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="reviewModal" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-clipboard-list me-2"></i>Answer Review</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                        <div id="reviewContent"></div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="bg-dark text-white text-center py-3 mt-5">
            <p class="mb-0">© 2025 Copyright UOS Mock Test Series | Powered By Mock Test Hub</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Global Variables
        let currentQuestion = 1;
        const totalQuestions = 100;
        let answers = {};
        let flaggedQuestions = new Set();
        let timeRemaining = 90 * 60; // 90 minutes
        let timerInterval;
        let testStartTime;
        let testEndTime;
        let passwordModalInstance;

        // MathJax Configuration
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']]
            },
            svg: { fontCache: 'global' }
        };

        const questionsData = {
          "English": [
            { "id": 1, "subject": "English", "topic": "Vocabulary", "question": "1. Choose the correct SYNONYMS of the words from the given options: OMIT", "options": ["A. Recluse", "B. Mistake", "C. Destroy", "D. Neglect"], "correct": 3 },
            { "id": 2, "subject": "English", "topic": "Vocabulary", "question": "2. Choose the correct SYNONYMS of the words from the given options: IMMACULATE", "options": ["A. Dirty", "B. Pure", "C. Filthy", "D. Neutral"], "correct": 1 },
            { "id": 3, "subject": "English", "topic": "Vocabulary", "question": "3. Choose the correct SYNONYMS of the words from the given options: PERFECT", "options": ["A. Bad", "B. Inactive", "C. Faultless", "D. Workless"], "correct": 2 },
            { "id": 4, "subject": "English", "topic": "Vocabulary", "question": "4. Choose the correct SYNONYMS of the words from the given options: ORAL", "options": ["A. Unnatural", "B. Spoken", "C. Formal", "D. Written"], "correct": 1 },
            { "id": 5, "subject": "English", "topic": "Vocabulary", "question": "5. Choose the correct SYNONYMS of the words from the given options: SYNTAX", "options": ["A. A point", "B. Grammar", "C. Hope", "D. Noise"], "correct": 1 },
            { "id": 6, "subject": "English", "topic": "Vocabulary", "question": "6. Choose the correct ANTONYMS of the words from the given options: CLARITY", "options": ["A. Exaggeration", "B. Candour", "C. Confusion", "D. Reserve"], "correct": 2 },
            { "id": 7, "subject": "English", "topic": "Vocabulary", "question": "7. Choose the correct ANTONYMS of the words from the given options: CONFESS", "options": ["A. Deny", "B. Refuse", "C. Contest", "D. Contend"], "correct": 0 },
            { "id": 8, "subject": "English", "topic": "Vocabulary", "question": "8. Choose the correct ANTONYMS of the words from the given options: ABHOR", "options": ["A. Love", "B. Likeness", "C. Attractiveness", "D. Loathe"], "correct": 0 },
            { "id": 9, "subject": "English", "topic": "Vocabulary", "question": "9. Choose the correct ANTONYMS of the words from the given options: FIXED", "options": ["A. Hesitant", "B. Corrected", "C. Loose", "D. Delay"], "correct": 2 },
            { "id": 10, "subject": "English", "topic": "Vocabulary", "question": "10. Choose the correct ANTONYMS of the words from the given options: VIOLENT", "options": ["A. Tame", "B. Humble", "C. Gentle", "D. Harmless"], "correct": 2 },
            { "id": 11, "subject": "English", "topic": "Prepositions", "question": "11. Choose the correct PREPOSITION to complete the sentence: I am going to join my duties ____ a week.", "options": ["A. For", "B. In", "C. At", "D. To"], "correct": 1 },
            { "id": 12, "subject": "English", "topic": "Prepositions", "question": "12. Choose the correct PREPOSITION to complete the sentence: Sattar is ____ vacation.", "options": ["A. With", "B. On", "C. For", "D. In"], "correct": 1 },
            { "id": 13, "subject": "English", "topic": "Prepositions", "question": "13. Choose the correct PREPOSITION to complete the sentence: Look ____ the Sky.", "options": ["A. On", "B. By", "C. In", "D. At"], "correct": 3 },
            { "id": 14, "subject": "English", "topic": "Prepositions", "question": "14. Choose the correct PREPOSITION to complete the sentence: She is old ____ her age.", "options": ["A. To", "B. For", "C. Of", "D. At"], "correct": 1 },
            { "id": 15, "subject": "English", "topic": "Prepositions", "question": "15. Choose the correct PREPOSITION to complete the sentence: A plane is ____ to fly.", "options": ["A. With", "B. About", "C. At", "D. By"], "correct": 1 },
            { "id": 16, "subject": "English", "topic": "Spelling", "question": "16. Choose the correctly spelled word from the given options.", "options": ["A. Affedevit", "B. Afidevit", "C. Affidevit", "D. Affidavit"], "correct": 3 },
            { "id": 17, "subject": "English", "topic": "Spelling", "question": "17. Choose the correctly spelled word from the given options.", "options": ["A. Centrefuge", "B. Centrefuge", "C. Centifuse", "D. Centrifuge"], "correct": 3 },
            { "id": 18, "subject": "English", "topic": "Spelling", "question": "18. Choose the correctly spelled word from the given options.", "options": ["A. Deference", "B. Defferance", "C. Defference", "D. Defference"], "correct": 0 },
            { "id": 19, "subject": "English", "topic": "Spelling", "question": "19. Choose the correctly spelled word from the given options.", "options": ["A. Enterpreneur", "B. Entreorenure", "C. Entrepreneur", "D. Enterprenure"], "correct": 2 },
            { "id": 20, "subject": "English", "topic": "Spelling", "question": "20. Choose the correctly spelled word from the given options.", "options": ["A. Bureacracy", "B. Bereaucracy", "C. Buereacracy", "D. Bureaucracy"], "correct": 3 },
            { "id": 21, "subject": "English", "topic": "Narration", "question": "21. Choose the correct narration of following sentences: He said to me, \"I am ready\".", "options": ["A. He told to me that he is ready.", "B. He told me that he was ready.", "C. He told me that I am ready.", "D. He told me that I will ready."], "correct": 1 },
            { "id": 22, "subject": "English", "topic": "Narration", "question": "22. Choose the correct narration of following sentences: Karim says, \"I shall go there\".", "options": ["A. Karim said that he went there.", "B. Karim says that he will go there.", "C. Karim says that he went there.", "D. Karim said that I will go there."], "correct": 1 },
            { "id": 23, "subject": "English", "topic": "Narration", "question": "23. Choose the correct narration of following sentences: Sultan will say to me, \"I am your classmate\".", "options": ["A. Sultan will tell me that he is my classmate.", "B. Sultan will tell me that he was my classmate.", "C. Sultan will tell me that he will be my classmate.", "D. Sultan said me that he is my classmate."], "correct": 0 },
            { "id": 24, "subject": "English", "topic": "Narration", "question": "24. Choose the correct narration of following sentences: He said to you, \"You may go out\".", "options": ["A. He told you that you might be go out.", "B. He said you that you might be go out.", "C. He told you that you may go out.", "D. He told you that you might go out."], "correct": 3 },
            { "id": 25, "subject": "English", "topic": "Narration", "question": "25. Choose the correct narration of following sentences: He said to me, \"I had to finish this first.\"", "options": ["A. He told me that he has to finish this first.", "B. He told me that he have to finish this first.", "C. He told me that he had had to finish that first.", "D. He told me that he had to finish that first."], "correct": 2 },
            { "id": 26, "subject": "English", "topic": "Voice", "question": "26. Choose the correct Active & Passive voice of following sentences: My father loves me.", "options": ["A. I loved my father.", "B. I was loved by my father.", "C. I were loved by my father.", "D. I am loved by my father."], "correct": 3 },
            { "id": 27, "subject": "English", "topic": "Voice", "question": "27. Choose the correct Active & Passive voice of following sentences: My friends are watching the match.", "options": ["A. The match is watched by my friends.", "B. The match had being watched by my friends.", "C. The match is being watched by my friends.", "D. The match has being watched by my friends."], "correct": 2 },
            { "id": 28, "subject": "English", "topic": "Voice", "question": "28. Choose the correct Active & Passive voice of following sentences: Sahil spoke the lie.", "options": ["A. The lie was spoke by Sahil.", "B. The lie spoken by Sahil.", "C. The lie is spoke by Sahil.", "D. The lie was spoken by Sahil."], "correct": 3 },
            { "id": 29, "subject": "English", "topic": "Voice", "question": "29. Choose the correct Active & Passive voice of following sentences: Somebody had already adopted him.", "options": ["A. He have been already adopted.", "B. He had already been adopted.", "C. He had already adopted.", "D. He has been already adopted."], "correct": 1 },
            { "id": 30, "subject": "English", "topic": "Voice", "question": "30. Choose the correct Active & Passive voice of following sentences: I must help him.", "options": ["A. He must helped by me.", "B. I must held him.", "C. He must get help from me.", "D. He must be helped by me."], "correct": 3 }
          ],
          "General Knowledge": [
            { "id": 31, "subject": "General Knowledge", "topic": "World & History", "question": "31. The largest river in the world is:", "options": ["A. Indus River", "B. Nile River", "C. Amazon River", "D. Jhelum River"], "correct": 2 },
            { "id": 32, "subject": "General Knowledge", "topic": "World & History", "question": "32. The last Mughal emperor was:", "options": ["A. Aurang Zeb Alamgir", "B. Jalal-ul-din Akbar", "C. Bahadur Shah Zafar", "D. Zaheer-din Babur"], "correct": 2 },
            { "id": 33, "subject": "General Knowledge", "topic": "World & History", "question": "33. Shalimar Gardens are located in:", "options": ["A. Delhi", "B. Thatta", "C. Lahore", "D. Agra"], "correct": 2 },
            { "id": 34, "subject": "General Knowledge", "topic": "World & History", "question": "34. The Karakoram Connect Pakistan with:", "options": ["A. Afghanistan", "B. China", "C. Iran", "D. Turkey"], "correct": 1 },
            { "id": 35, "subject": "General Knowledge", "topic": "World & History", "question": "35. Who was the champion of the 2023 Cricket Asia Cup?", "options": ["A. India", "B. Sri Lanka", "C. Pakistan", "D. Bangladesh"], "correct": 0 },
            { "id": 36, "subject": "General Knowledge", "topic": "World & History", "question": "36. Muhammad Bin Qasim entered in Sindh from which region of Sindh?", "options": ["A. Mansura", "B. Debal", "C. Manora", "D. Bhambhore"], "correct": 1 },
            { "id": 37, "subject": "General Knowledge", "topic": "World & History", "question": "37. Karoonjhar Mountains located in:", "options": ["A. Sehwan", "B. Thatta", "C. Tharparkar", "D. Rohri"], "correct": 2 },
            { "id": 38, "subject": "General Knowledge", "topic": "World & History", "question": "38. Hamal lake located in:", "options": ["A. Qambar", "B. Dadu", "C. Sehwan", "D. Hyderabad"], "correct": 0 },
            { "id": 39, "subject": "General Knowledge", "topic": "World & History", "question": "39. Lowest point of Asia:", "options": ["A. Caspian Sea", "B. Dead Sea", "C. Lake Assal", "D. Lake Eyre"], "correct": 1 },
            { "id": 40, "subject": "General Knowledge", "topic": "World & History", "question": "40. Largest producer of Tea is:", "options": ["A. Brazil", "B. China", "C. Pakistan", "D. India"], "correct": 1 },
            { "id": 41, "subject": "General Knowledge", "topic": "World & History", "question": "41. South Pole is located in:", "options": ["A. Africa", "B. Australia", "C. Greenland", "D. Antarctica"], "correct": 3 },
            { "id": 42, "subject": "General Knowledge", "topic": "World & History", "question": "42. \"Kwacha\" is currency of:", "options": ["A. Togo", "B. Zambia", "C. Maldives", "D. Taiwan"], "correct": 1 },
            { "id": 43, "subject": "General Knowledge", "topic": "World & History", "question": "43. Capital city of South Korea is:", "options": ["A. Pyongyang", "B. Bishkek", "C. Male", "D. Seoul"], "correct": 3 },
            { "id": 44, "subject": "General Knowledge", "topic": "World & History", "question": "44. Land of Golden Fleece is known as:", "options": ["A. Australia", "B. Bangladesh", "C. Scotland", "D. Thailand"], "correct": 0 },
            { "id": 45, "subject": "General Knowledge", "topic": "World & History", "question": "45. Who wrote \"The Struggle for Pakistan\"?", "options": ["A. Aitzaz Ahsan", "B. Akbar S. Ahmed", "C. Main Ata Rabani", "D. Ayesha Jalal"], "correct": 3 },
            { "id": 46, "subject": "General Knowledge", "topic": "World & History", "question": "46. Border between Pakistan and Afghanistan is known as:", "options": ["A. Silk line", "B. Safak line", "C. Durand Line", "D. Gojal Line"], "correct": 2 },
            { "id": 47, "subject": "General Knowledge", "topic": "World & History", "question": "47. The constitution of 1973 consists of ____ Articles.", "options": ["A. 234", "B. 250", "C. 270", "D. 280"], "correct": 3 },
            { "id": 48, "subject": "General Knowledge", "topic": "World & History", "question": "48. In 1911, who was the Viceroy of India?", "options": ["A. Lord Rippon", "B. Lord Hardinge", "C. Lord Curzon", "D. Lord Canning"], "correct": 1 },
            { "id": 49, "subject": "General Knowledge", "topic": "World & History", "question": "49. The main occupation of the people of Indus valley was:", "options": ["A. Trade", "B. Fishing", "C. Hunting", "D. None of these"], "correct": 0 },
            { "id": 50, "subject": "General Knowledge", "topic": "World & History", "question": "50. LNG stands for", "options": ["A. Liquid Natural Gas", "B. Liquefied Natural Gas", "C. Lithogram Natural Gas", "D. None"], "correct": 1 }
          ],
          "General Science": [
            { "id": 51, "subject": "General Science", "topic": "Science Principles", "question": "51. Chemical Symbol of Potassium:", "options": ["A. Mg", "B. Pa", "C. Au", "D. K"], "correct": 3 },
            { "id": 52, "subject": "General Science", "topic": "Science Principles", "question": "52. Shortest day on", "options": ["A. Neptune", "B. Venus", "C. Saturn", "D. Jupiter"], "correct": 3 },
            { "id": 53, "subject": "General Science", "topic": "Science Principles", "question": "53. What is the maximum length of a day on the poles?", "options": ["A. 6 months", "B. one year", "C. 8 months", "D. 2 year"], "correct": 0 },
            { "id": 54, "subject": "General Science", "topic": "Science Principles", "question": "54. Earthquakes rarely occur in:", "options": ["A. Brazil", "B. Alaska", "C. Mexico", "D. Russia"], "correct": 0 },
            { "id": 55, "subject": "General Science", "topic": "Science Principles", "question": "55. Oxygen in the upper atmosphere is converted in", "options": ["A. Hydrogen", "B. Ozone", "C. Nitrogen", "D. CO2"], "correct": 1 },
            { "id": 56, "subject": "General Science", "topic": "Science Principles", "question": "56. The instruments used for measuring humidity in air is:", "options": ["A. Pantograph", "B. Hygrograph", "C. Hydrograph", "D. Barograph"], "correct": 1 },
            { "id": 57, "subject": "General Science", "topic": "Science Principles", "question": "57. The nearest relatives of man are:", "options": ["A. New world monkey", "B. Apes", "C. Old world monkey", "D. Lemurs."], "correct": 1 },
            { "id": 58, "subject": "General Science", "topic": "Science Principles", "question": "58. Wisdom teeth normally grow during the of:", "options": ["A. 17-30 years", "B. 12-15 years", "C. 30-40 years", "D. 40-45 years"], "correct": 0 },
            { "id": 59, "subject": "General Science", "topic": "Science Principles", "question": "59. Saliva in man is:", "options": ["A. Acidic", "B. Alkaline", "C. Neutral", "D. None of these"], "correct": 1 },
            { "id": 60, "subject": "General Science", "topic": "Science Principles", "question": "60. The largest part of the human brain is:", "options": ["A. Cerebellum", "B. Cerebrum", "C. Mid-brain", "D. Medulla"], "correct": 1 },
            { "id": 61, "subject": "General Science", "topic": "Science Principles", "question": "61. The mammal which lay eggs is:", "options": ["A. Bat", "B. Duck-billed platypus", "C. Squirrel", "D. Kangaroo"], "correct": 1 },
            { "id": 62, "subject": "General Science", "topic": "Science Principles", "question": "62. Snake bite first affects the:", "options": ["A. Lungs", "B. Brain", "C. Nervous system", "D. Blood Circulation"], "correct": 2 },
            { "id": 63, "subject": "General Science", "topic": "Science Principles", "question": "63. Milk is a poor source of:", "options": ["A. Proteins", "B. Iron", "C. Butyric acid", "D. Calcium"], "correct": 1 },
            { "id": 64, "subject": "General Science", "topic": "Science Principles", "question": "64. Which acid is produced when milk gets sour?", "options": ["A. Tartaric acid", "B. Lactic acid", "C. Butyric acid", "D. Acetic acid"], "correct": 1 },
            { "id": 65, "subject": "General Science", "topic": "Science Principles", "question": "65. Diamond is an allotropic form of:", "options": ["A. Silicon", "B. Carbon", "C. Sulphur", "D. Germanium"], "correct": 1 },
            { "id": 66, "subject": "General Science", "topic": "Science Principles", "question": "66. Sound can't travel through:", "options": ["A. Solids", "B. Liquid", "C. Vacuum", "D. Gases"], "correct": 2 },
            { "id": 67, "subject": "General Science", "topic": "Science Principles", "question": "67. The ear is part of:", "options": ["A. Skeletal system", "B. Cardiovascular System", "C. Nervous System", "D. None"], "correct": 2 },
            { "id": 68, "subject": "General Science", "topic": "Science Principles", "question": "68. The tea best for digestion is:", "options": ["A. Purple tea", "B. Pink tea", "C. Black tea", "D. Green tea"], "correct": 3 },
            { "id": 69, "subject": "General Science", "topic": "Science Principles", "question": "69. Keyboard of computer science is:", "options": ["A. Software", "B. Hardware", "C. Firmware", "D. All of these"], "correct": 1 },
            { "id": 70, "subject": "General Science", "topic": "Science Principles", "question": "70. One centimeter is equal to", "options": ["A. $\\frac{1}{100}$ meter", "B. $\\frac{1}{10}$ meter", "C. 1 meter", "D. $\\frac{1}{1000}$ meter"], "correct": 0 }
          ],
          "Mathematics": [
            { "id": 71, "subject": "Mathematics", "topic": "Problem Solving", "question": "71. \\(\\sqrt{248+\\sqrt{52+\\sqrt{144}}}\\)", "options": ["A. 18.8", "B. 16.6", "C. 16", "D. 14"], "correct": 2 },
            { "id": 72, "subject": "Mathematics", "topic": "Algebra", "question": "72. If \\(36xy=18xyz,\\) then z is equal to:", "options": ["A. 5", "B. 3", "C. 4", "D. 2"], "correct": 3 },
            { "id": 73, "subject": "Mathematics", "topic": "Sequences", "question": "73. What is the next in the following series, 1, 3, 8, 19,...", "options": ["A. 40", "B. 41", "C. 42", "D. 38"], "correct": 2 },
            { "id": 74, "subject": "Mathematics", "topic": "Arithmetic", "question": "74. Which among the following is the greatest number?", "options": ["A. \\(\\frac{1}{4}\\) of 236", "B. \\(\\frac{1}{3}\\) of 741", "C. \\(\\frac{1}{16}\\) of 1028", "D. \\(\\frac{1}{9}\\) of 504"], "correct": 1 },
            { "id": 75, "subject": "Mathematics", "topic": "Problem Solving", "question": "75. A person washes eight cars in eighteen minutes, at the same rate how many cars wash in three hours?", "options": ["A. 13", "B. 40", "C. 125", "D. 80"], "correct": 3 },
            { "id": 76, "subject": "Mathematics", "topic": "Algebra", "question": "76. If \\(\\frac{x}{4}=\\frac{y}{2}\\), then", "options": ["A. \\(x=2y\\)", "B. \\(y=2x\\)", "C. \\(x=y\\)", "D. \\(y=x^{2}\\)"], "correct": 0 },
            { "id": 77, "subject": "Mathematics", "topic": "Problem Solving", "question": "77. Two apples and three mangoes cost Rs. 86, four apples and one mango cost Rs.112, What is the cost of an apple?", "options": ["A. 35", "B. 30", "C. 25", "D. 20"], "correct": 2 },
            { "id": 78, "subject": "Mathematics", "topic": "Percentages", "question": "78. Ayaz lost 20% by selling a radio set for Rs.680. Which of the following was the original cost of the ratio?", "options": ["A. 800", "B. 900", "C. 850", "D. None of these"], "correct": 2 },
            { "id": 79, "subject": "Mathematics", "topic": "Arithmetic", "question": "79. \\(\\sqrt{\\frac{1}{4}}+\\sqrt[3]{\\frac{1}{8}}\\) is equal to:", "options": ["A. 0", "B. 1", "C. \\(\\frac{1}{2}\\)", "D. \\(\\sqrt[3]{\\frac{1}{2}}\\)"], "correct": 1 },
            { "id": 80, "subject": "Mathematics", "topic": "Number Systems", "question": "80. MMDCLXXX =", "options": ["A. 2570", "B. 2670", "C. 2680", "D. 2770"], "correct": 2 },
            { "id": 81, "subject": "Mathematics", "topic": "Exponents", "question": "81. If \\(\\sqrt{2^{n}}=64\\) then find the value of \"n\".", "options": ["A. 8", "B. 10", "C. 12", "D. 16"], "correct": 2 },
            { "id": 82, "subject": "Mathematics", "topic": "Ratio and Proportion", "question": "82. Find a third proportional to the number 4, 42.", "options": ["A. 441", "B. 541", "C. 641", "D. None of these"], "correct": 0 },
            { "id": 83, "subject": "Mathematics", "topic": "Ratio and Proportion", "question": "83. The ratio of boys and girls in a school is 9:5. If the total number of students in the school is 1050, then the number of boys is:", "options": ["A. 785", "B. 890", "C. 675", "D. None of these"], "correct": 2 },
            { "id": 84, "subject": "Mathematics", "topic": "Percentages", "question": "84. What percentage is equivalent to \\(5\\frac{1}{4}\\) ?", "options": ["A. 525%", "B. 425%", "C. 625%", "D. None of these"], "correct": 0 },
            { "id": 85, "subject": "Mathematics", "topic": "Algebra", "question": "85. The solution set the system of equation \\(xy - 8 = 7\\) and \\(2x+6=8x\\) is", "options": ["A. \\((1,15)\\)", "B. \\((2,15)\\)", "C. \\((3,1)\\)", "D. \\((1,3)\\)"], "correct": 0 },
            { "id": 86, "subject": "Mathematics", "topic": "Arithmetic", "question": "86. \\(90^{2}-70^{2}=?\\)", "options": ["A. 3000", "B. 3100", "C. 3200", "D. 3500"], "correct": 2 },
            { "id": 87, "subject": "Mathematics", "topic": "Algebra", "question": "87. What is the value of \\(a^{2}+b^{2}\\), if \\(a+b=5\\) and \\(ab=2\\).", "options": ["A. 21", "B. 24", "C. 25", "D. 30"], "correct": 0 },
            { "id": 88, "subject": "Mathematics", "topic": "Problem Solving", "question": "88. If 5 meters of cloth cost Rs.50, How many meters of the cloth can be purchase for Rs.750?", "options": ["A. 15", "B. 25", "C. 45", "D. 75"], "correct": 3 },
            { "id": 89, "subject": "Mathematics", "topic": "Trigonometry", "question": "89. The value of tan45 is", "options": ["A. \\(\\frac{1}{\\sqrt{3}}\\)", "B. \\(\\frac{1}{\\sqrt{2}}\\)", "C. 1", "D. \\(\\sqrt{3}\\)"], "correct": 2 },
            { "id": 90, "subject": "Mathematics", "topic": "Number Systems", "question": "90. 1 (one) is a ____ number?", "options": ["A. Prime", "B. Composite", "C. Even", "D. None"], "correct": 3 }
          ],
          "I.Q": [
            { "id": 91, "subject": "I.Q", "topic": "Logical Reasoning", "question": "91. What is a Burgee a type of?", "options": ["A. Elastic", "B. Flag", "C. Row", "D. Food"], "correct": 1 },
            { "id": 92, "subject": "I.Q", "topic": "Logical Reasoning", "question": "92. What number should replace the question mark? (Pattern 1: 9,6,7,7 -> 16. Pattern 2: 7,3,6,4 -> 33. Question: 8,2,3,2 -> ??)", "options": ["A. 30", "B. 10", "C. 24", "D. 16"], "correct": 1 },
            { "id": 93, "subject": "I.Q", "topic": "Logical Reasoning", "question": "93. What is the next in following series? 64, 32, 16, 8,...", "options": ["A. 2", "B. 4", "C. 6", "D. 1"], "correct": 1 },
            { "id": 94, "subject": "I.Q", "topic": "Logical Reasoning", "question": "94. If $5+3=538$ and $9+1=9110$, then $8+4=?", "options": ["A. 8412", "B. 4812", "C. 8432", "D. 1284"], "correct": 0 },
            { "id": 95, "subject": "I.Q", "topic": "Logical Reasoning", "question": "95. \"Talent\" is most opposite to", "options": ["A. Ungrateful", "B. Silent", "C. Untalented", "D. Inability"], "correct": 3 },
            { "id": 96, "subject": "I.Q", "topic": "Logical Reasoning", "question": "96. If \"BEST\" is equivalent to \"DGUV\" then \"ENTER\" is equivalent to?", "options": ["A. GPVXC", "B. GPVGT", "C. GPVTA", "D. HIUTV"], "correct": 1 },
            { "id": 97, "subject": "I.Q", "topic": "Logical Reasoning", "question": "97. Next number is the series 3, 8, 13, 18, 23,...", "options": ["A. 27", "B. 28", "C. 29", "D. 26"], "correct": 1 },
            { "id": 98, "subject": "I.Q", "topic": "Logical Reasoning", "question": "98. What number should replace the question mark? (Grid: R1: 1,3,7,13; R2: 4,6,10,16; R3: 9,11,15,21; R4: 16,18,22,?)", "options": ["A. 28", "B. 23", "C. 19", "D. 30"], "correct": 0 },
            { "id": 99, "subject": "I.Q", "topic": "Logical Reasoning", "question": "99. How many even prime numbers are there?", "options": ["A. 1", "B. 4", "C. 5", "D. None of these"], "correct": 0 },
            { "id": 100, "subject": "I.Q", "topic": "Logical Reasoning", "question": "100. Find the odd man out.", "options": ["A. Sea", "B. Lake", "C. Stream", "D. Bridge"], "correct": 3 }
          ]
        };

        const allQuestions = [];
        Object.values(questionsData).forEach(sectionQuestions => {
            allQuestions.push(...sectionQuestions);
        });

        // Event Listener for DOMContentLoaded
        document.addEventListener('DOMContentLoaded', function() {
            passwordModalInstance = new bootstrap.Modal(document.getElementById('passwordModal'));
            passwordModalInstance.show();
            initializeTheme();
        });

        function verifyPassword() {
            const password = document.getElementById('passwordInput').value;
            if (password === 'uostestbymk') {
                passwordModalInstance.hide();
                document.getElementById('mainContent').style.display = 'block';
                startTest();
            } else {
                document.getElementById('passwordError').textContent = 'Incorrect password.';
                document.getElementById('passwordInput').classList.add('is-invalid');
            }
        }

        document.getElementById('passwordInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') verifyPassword();
        });

        function startTest() {
            testStartTime = new Date();
            generateQuestionPalette();
            startTimer();
            loadQuestion(1);
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    autoSubmitTest();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timer').textContent = 
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            if (timeRemaining <= 300) { // 5 minutes warning
                document.getElementById('timer').style.background = 'linear-gradient(45deg, #dc3545, #c82333)';
            }
        }

        function generateQuestionPalette() {
            const palette = document.getElementById('questionPalette');
            palette.innerHTML = '';
            for (let i = 1; i <= totalQuestions; i++) {
                const button = document.createElement('button');
                button.className = 'question-number btn d-inline-flex align-items-center justify-content-center';
                button.textContent = i;
                button.onclick = () => loadQuestion(i);
                palette.appendChild(button);
            }
        }

        function loadQuestion(questionNum) {
            currentQuestion = questionNum;
            const question = allQuestions[questionNum - 1];
            
            document.getElementById('currentQuestionNum').textContent = questionNum;
            document.getElementById('questionContent').innerHTML = 
                `<h6><span class="badge bg-info me-2">${question.subject}</span>${question.topic}</h6>
                 <p class="lead">${question.question}</p>`;
            
            let optionsHTML = '';
            question.options.forEach((option, index) => {
                const isSelected = answers[questionNum] === (index + 1) ? 'selected' : '';
                optionsHTML += `<div class="option-card ${isSelected}" onclick="selectOption(${index + 1})">${option}</div>`;
            });
            document.getElementById('optionsContent').innerHTML = optionsHTML;
            
            document.getElementById('prevBtn').style.display = questionNum === 1 ? 'none' : 'inline-block';
            document.getElementById('nextBtn').style.display = questionNum === totalQuestions ? 'none' : 'inline-block';
            document.getElementById('submitBtn').style.display = questionNum === totalQuestions ? 'inline-block' : 'none';
            
            const flagBtn = document.getElementById('flagBtn');
            if (flaggedQuestions.has(questionNum)) {
                flagBtn.innerHTML = '<i class="fas fa-flag me-1"></i>Unflag';
                flagBtn.className = 'btn btn-danger btn-sm';
            } else {
                flagBtn.innerHTML = '<i class="fas fa-flag me-1"></i>Flag';
                flagBtn.className = 'btn btn-warning btn-sm';
            }
            
            updateQuestionPalette();
            
            if (window.MathJax) {
                MathJax.typesetPromise().catch(err => console.log('MathJax Error:', err));
            }
            
            const card = document.getElementById('questionCard');
            card.classList.remove('fade-in');
            void card.offsetWidth; // Trigger reflow
            card.classList.add('fade-in');
        }

        function selectOption(optionNum) {
            answers[currentQuestion] = optionNum;
            loadQuestion(currentQuestion); // Reload to show selection
        }

        function updateQuestionPalette() {
            document.querySelectorAll('.question-number').forEach((button, index) => {
                const qNum = index + 1;
                button.className = 'question-number btn d-inline-flex align-items-center justify-content-center'; // Reset classes
                if (answers[qNum]) button.classList.add('answered');
                if (flaggedQuestions.has(qNum)) button.classList.add('flagged');
                if (qNum === currentQuestion) button.classList.add('current');
            });
        }

        function previousQuestion() { if (currentQuestion > 1) loadQuestion(currentQuestion - 1); }
        function nextQuestion() { if (currentQuestion < totalQuestions) loadQuestion(currentQuestion + 1); }

        function toggleFlag() {
            if (flaggedQuestions.has(currentQuestion)) {
                flaggedQuestions.delete(currentQuestion);
            } else {
                flaggedQuestions.add(currentQuestion);
            }
            loadQuestion(currentQuestion);
        }

        function submitTest() {
            if (confirm('Are you sure you want to submit the test?')) {
                finalizeTest();
            }
        }

        function autoSubmitTest() {
            alert("Time's up! The test will now be submitted automatically.");
            finalizeTest();
        }
        
        function finalizeTest() {
            testEndTime = new Date();
            clearInterval(timerInterval);
            calculateResults();
        }

        function calculateResults() {
            let correct = 0;
            allQuestions.forEach(q => {
                if ((answers[q.id] - 1) === q.correct) {
                    correct++;
                }
            });
            
            const totalAttempted = Object.keys(answers).length;
            const isPassed = correct >= 50;
            const timeTaken = Math.floor((testEndTime - testStartTime) / 1000);
            
            window.testResults = {
                obtainedMarks: correct,
                totalMarks: totalQuestions,
                isPassed,
                correctAnswers: correct,
                totalAttempted,
                timeTaken,
                answers
            };
            displayResults();
        }

        function displayResults() {
            const r = window.testResults;
            const minutes = Math.floor(r.timeTaken / 60);
            const seconds = r.timeTaken % 60;
            
            document.getElementById('resultContent').innerHTML = `
                <div class="row text-center">
                    <div class="col-md-4 mb-3">
                        <h2 class="display-4">${r.obtainedMarks}</h2><p>Marks Obtained</p>
                    </div>
                    <div class="col-md-4 mb-3">
                        <h2 class="display-4">${r.totalMarks}</h2><p>Total Marks</p>
                    </div>
                    <div class="col-md-4 mb-3">
                        <h2 class="display-4 ${r.isPassed ? 'text-success' : 'text-danger'}">${r.isPassed ? 'PASS' : 'FAIL'}</h2>
                        <p>Result</p>
                    </div>
                </div>
                <hr class="my-4">
                <div class="row text-center">
                    <div class="col-md-6"><h5><i class="fas fa-clock me-2"></i>Time Taken</h5><p class="lead">${minutes}:${String(seconds).padStart(2, '0')} min</p></div>
                    <div class="col-md-6"><h5><i class="fas fa-percentage me-2"></i>Percentage</h5><p class="lead">${r.obtainedMarks}%</p></div>
                </div>`;
            
            new bootstrap.Modal(document.getElementById('resultModal')).show();
        }

        function retakeTest() {
            if (confirm('Are you sure you want to retake the test?')) {
                location.reload(); // Simple and effective way to reset everything
            }
        }

        function showReview() {
            const { answers } = window.testResults;
            let reviewHTML = '';
            
            const sectionOrder = ['English', 'General Knowledge', 'General Science', 'Mathematics', 'I.Q'];
            sectionOrder.forEach(sectionName => {
                reviewHTML += `<h4 class="text-primary border-bottom pb-2 mt-4"><i class="fas fa-book-open me-2"></i>${sectionName}</h4>`;
                questionsData[sectionName].forEach(q => {
                    const userAnswer = answers[q.id];
                    const isCorrect = (userAnswer - 1) === q.correct;
                    let statusClass, statusIcon, statusText, userAnswerText;

                    if (userAnswer === undefined) {
                        [statusClass, statusIcon, statusText, userAnswerText] = 
                            ['review-unattempted', 'fa-minus-circle text-secondary', 'Not Attempted', 'Not Attempted'];
                    } else if (isCorrect) {
                        [statusClass, statusIcon, statusText, userAnswerText] = 
                            ['review-correct', 'fa-check-circle text-success', 'Correct', q.options[userAnswer - 1]];
                    } else {
                        [statusClass, statusIcon, statusText, userAnswerText] = 
                            ['review-incorrect', 'fa-times-circle text-danger', 'Incorrect', q.options[userAnswer - 1]];
                    }
                    
                    const correctAnswerText = q.options[q.correct];
                    reviewHTML += `
                        <div class="card mb-3 ${statusClass}">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">Q ${q.id}: ${q.topic}</h6>
                                <span class="badge bg-light text-dark"><i class="fas ${statusIcon} me-1"></i>${statusText}</span>
                            </div>
                            <div class="card-body">
                                <p><strong>Question:</strong> ${q.question}</p>
                                <p><strong>Your Answer:</strong> ${userAnswerText}</p>
                                <p><strong>Correct Answer:</strong> ${correctAnswerText}</p>
                            </div>
                        </div>`;
                });
            });
            
            document.getElementById('reviewContent').innerHTML = reviewHTML;
            new bootstrap.Modal(document.getElementById('reviewModal')).show();
            if (window.MathJax) MathJax.typesetPromise();
        }
        
        async function generateCompletePDF() {
            document.getElementById('pdfProgress').style.display = 'flex';
            updateProgress(0, 'Initializing...');
            
            try {
                if (typeof window.jspdf === 'undefined' || typeof window.html2canvas === 'undefined') {
                    throw new Error('PDF generation libraries not loaded.');
                }
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                const results = window.testResults;
                const pageWidth = doc.internal.pageSize.width;
                const margin = 15;
                let yPos = 0;

                const addHeader = () => {
                    doc.setFillColor(102, 126, 234);
                    doc.rect(0, 0, pageWidth, 40, 'F');
                    doc.setTextColor(255).setFontSize(18).setFont('helvetica', 'bold').text('UOS Mock Test Results', margin, 20);
                    doc.setFontSize(10).setFont('helvetica', 'normal').text(`Generated: ${new Date().toLocaleDateString()}`, margin, 28);
                    yPos = 50;
                };

                const checkPageOverflow = (requiredSpace) => {
                    if (yPos + requiredSpace > doc.internal.pageSize.height - margin) {
                        doc.addPage();
                        addHeader();
                    }
                };
                
                const cleanLatex = (text) => text.replace(/\\\(|\\\)|\\\[|\\\]|\$|\$\$/g, '').replace(/\\frac\{([^}]+)\}\{([^}]+)\}/g, '($1)/($2)');

                addHeader();
                
                updateProgress(10, 'Adding result summary...');
                doc.setTextColor(0).setFontSize(14).setFont('helvetica', 'bold').text('Test Summary', margin, yPos);
                yPos += 10;
                doc.setFontSize(11).setFont('helvetica', 'normal');
                doc.text(`Marks: ${results.obtainedMarks}/${results.totalMarks}  |  Percentage: ${results.obtainedMarks}%  |  Result: ${results.isPassed ? 'PASS' : 'FAIL'}`, margin, yPos);
                yPos += 8;
                doc.text(`Attempted: ${results.totalAttempted}  |  Correct: ${results.correctAnswers}  |  Incorrect: ${results.totalAttempted - results.correctAnswers}`, margin, yPos);
                yPos += 15;

                updateProgress(20, 'Processing questions...');
                let questionCounter = 0;
                for (const sectionName of ['English', 'General Knowledge', 'General Science', 'Mathematics', 'I.Q']) {
                    checkPageOverflow(15);
                    doc.setFillColor(230, 230, 230).rect(margin, yPos-5, pageWidth - 2*margin, 10, 'F');
                    doc.setTextColor(0).setFontSize(12).setFont('helvetica', 'bold').text(sectionName, margin + 2, yPos + 2);
                    yPos += 15;

                    for (const q of questionsData[sectionName]) {
                        questionCounter++;
                        updateProgress(20 + Math.floor((questionCounter / totalQuestions) * 75), `Processing Q#${q.id}`);
                        
                        const userAnswer = results.answers[q.id];
                        const isCorrect = (userAnswer - 1) === q.correct;
                        checkPageOverflow(30);

                        doc.setFontSize(10).setFont('helvetica', 'bold').text(`Q${q.id}: ${cleanLatex(q.question)}`, margin, yPos);
                        yPos += 7;
                        
                        q.options.forEach((opt, idx) => {
                            const isUserAns = userAnswer === (idx + 1);
                            const isCorrectAns = q.correct === idx;
                            let prefix = '';
                            if (isCorrectAns) { prefix = '✓ '; doc.setTextColor(34, 139, 34); }
                            if (isUserAns && !isCorrect) { prefix = '✗ '; doc.setTextColor(220, 20, 60); }
                            
                            doc.setFont('helvetica', (isUserAns || isCorrectAns) ? 'bold' : 'normal').text(prefix + cleanLatex(opt), margin + 5, yPos);
                            doc.setTextColor(0); // Reset color
                            yPos += 6;
                        });
                        yPos += 5;
                    }
                }
                
                updateProgress(100, 'Finalizing...');
                doc.save(`UOS_Mock_Test_Report_${Date.now()}.pdf`);
                document.getElementById('pdfProgress').style.display = 'none';

            } catch (error) {
                console.error('PDF generation failed:', error);
                alert('Failed to generate PDF. See console for details.');
                document.getElementById('pdfProgress').style.display = 'none';
            }
        }
        
        function updateProgress(percentage, text) {
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = text;
        }

        // Theme Toggle
        let currentTheme = 'light';
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            document.querySelector('#themeToggle i').className = currentTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('theme', currentTheme);
        }

        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                toggleTheme(); // Apply dark theme if saved
            }
        }

        // Prevent Cheating
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', e => {
            if (e.key === 'F12' || (e.ctrlKey && (e.key === 'u' || e.key === 's' || e.key === 'c'))) {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>