<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UOS Mock Test Batch 2k26 - Test 2</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #0dcaf0;
            --light-color: #f8f9fa;
            --dark-color: #212529;
        }

        [data-theme="dark"] {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #0dcaf0;
            --light-color: #212529;
            --dark-color: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light-color);
            color: var(--dark-color);
            transition: all 0.3s ease;
        }

        [data-theme="dark"] body {
            background: var(--dark-color);
            color: var(--light-color);
        }

        .header-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        [data-theme="dark"] .header-gradient {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        }

        /* Ensure proper centering on all devices */
        .text-center-mobile {
            text-align: center;
        }
        
        .btn-full-width-mobile {
            width: 100%;
        }
        
        .flex-column-mobile {
            flex-direction: column;
        }
        
        .align-items-center-mobile {
            align-items: center;
        }
        
        .justify-content-center-mobile {
            justify-content: center;
        }
        
        /* Responsive card adjustments */
        .card {
            margin-bottom: 15px;
        }
        
        /* Responsive option cards */
        .option-card {
            transition: all 0.3s ease;
            margin: 8px 0;
        }
        
        /* Responsive button adjustments */
        .btn-custom {
            margin: 4px;
            transition: all 0.3s ease;
        }

        .header-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        [data-theme="dark"] .header-gradient {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        }

        .question-palette {
            max-height: 80px;
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            margin-top: 15px;
            padding: 10px; /* Add padding */
            background: rgba(0,0,0,0.03); /* Light background */
            border-radius: 8px; /* Rounded corners */
        }

        [data-theme="dark"] .question-palette {
            background: rgba(255,255,255,0.1);
        }

        .question-number {
            min-width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            background: white;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 3px; /* Add horizontal margin for spacing */
            font-weight: 500; /* Make numbers bolder */
        }

        [data-theme="dark"] .question-number {
            background: #495057;
            color: white;
            border-color: #6c757d;
        }

        .question-number:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .question-number.current {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: bold;
            transform: scale(1.1); /* Slightly enlarge current question */
        }

        .question-number.answered {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }

        .question-number.flagged {
            background: var(--warning-color);
            color: black;
            border-color: var(--warning-color);
        }

        .question-number.flagged.answered {
            background: var(--info-color);
            color: white;
            border-color: var(--info-color);
        }

        .timer {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* Shake animation for password error */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .animate__shakeX {
            animation: shake 0.5s ease-in-out;
        }

        .option-card {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px 20px; /* Increased padding for better spacing */
            margin: 10px 0; /* Increased margin for better separation */
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            position: relative; /* For better positioning */
        }

        [data-theme="dark"] .option-card {
            background: #495057;
            border-color: #6c757d;
            color: white;
        }

        .option-card:hover {
            border-color: var(--primary-color);
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(13, 110, 253, 0.2);
        }

        .option-card.selected {
            border-color: var(--primary-color);
            background: rgba(13, 110, 253, 0.1);
            font-weight: 500; /* Make selected options bolder */
        }

        .btn-custom {
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
            margin: 5px; /* Add margin for better spacing between buttons */
        }

        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .result-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .card-header {
            padding: 25px; /* Increase padding for better spacing */
        }

        .card-footer {
            padding: 20px; /* Increase padding for better spacing */
            background-color: #f8f9fa;
        }

        [data-theme="dark"] .card-footer {
            background-color: #343a40;
        }

        .review-correct {
            background: rgba(25, 135, 84, 0.1);
            border-left: 4px solid var(--success-color);
        }

        .review-incorrect {
            background: rgba(220, 53, 69, 0.1);
            border-left: 4px solid var(--danger-color);
        }

        .review-unattempted {
            background: rgba(108, 117, 125, 0.1);
            border-left: 4px solid var(--secondary-color);
        }

        .modal-custom {
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* MathJax Styling */
        .MathJax {
            font-size: 1.1em !important;
        }

        .question-content .MathJax {
            font-size: 1.2em !important;
        }

        /* PDF Progress Modal */
        .pdf-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .pdf-progress-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .progress-bar-custom {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .retake-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
            transition: all 0.3s ease;
        }

        .retake-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(40, 167, 69, 0.6);
            background: linear-gradient(45deg, #218838, #1e7e34);
        }

        @media (max-width: 768px) {
            .question-palette {
                max-height: 60px;
            }
            
            .question-number {
                min-width: 35px;
                height: 35px;
                font-size: 12px;
            }
            
            .timer {
                font-size: 14px;
                padding: 8px 16px;
            }
            
            .floating-btn {
                width: 50px;
                height: 50px;
                bottom: 20px;
                right: 20px;
            }

            .MathJax {
                font-size: 1em !important;
            }
            
            /* Center buttons only on mobile */
            .card-footer .btn-custom {
                width: 100%;
                margin: 5px 0;
            }
            
            .modal-footer .btn-custom, .modal-footer .retake-btn {
                width: 100%;
                margin: 5px 0;
            }
            
            /* Center navigation buttons on mobile */
            .text-md-end {
                text-align: center !important;
            }
        }
        
        /* Additional mobile-specific styles for better responsiveness */
        @media (max-width: 576px) {
            .header-gradient h1 {
                font-size: 1.2rem;
                text-align: center;
            }
            
            .timer {
                font-size: 12px;
                padding: 6px 12px;
            }
            
            .question-number {
                min-width: 30px;
                height: 30px;
                font-size: 10px;
                margin: 0 2px;
            }
            
            .btn-custom {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
   
</head>
<body>
    <div class="pdf-progress" id="pdfProgress">
        <div class="pdf-progress-content">
            <h4><i class="fas fa-file-pdf text-danger me-2"></i>Generating PDF Report</h4>
            <div class="progress-bar-custom">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="progressText">Preparing document...</p>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <div class="modal fade" id="passwordModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title"><i class="fas fa-lock me-2"></i>Secure Access Required</h5>
                </div>
                <div class="modal-body text-center">
                    <div class="mb-4">
                        <i class="fas fa-shield-alt fa-3x text-primary mb-3"></i>
                        <h6>Enter Password to Access Test</h6>
                    </div>
                    <input type="password" class="form-control text-center" id="passwordInput" 
                           placeholder="Enter Password" maxlength="20">
                    <div class="invalid-feedback" id="passwordError"></div>
                </div>
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-primary btn-custom" onclick="verifyPassword()">
                        <i class="fas fa-key me-2"></i>Access Test
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="mainContent" style="display: none;">
        <header class="header-gradient text-white py-4 shadow-lg">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="h3 mb-0"><i class="fas fa-graduation-cap me-2"></i>UOS Mock Test Batch 2k26 - Test 2</h1>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <div class="d-flex align-items-center justify-content-md-end justify-content-center gap-3">
                            <div class="timer" id="timer">90:00</div>
                            <button class="btn btn-outline-light btn-sm" onclick="toggleTheme()" id="themeToggle">
                                <i class="fas fa-moon"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="container my-4">
            <div class="row">
                <div class="col-12">
                    <div class="card shadow-lg border-0" id="questionCard">
                        <div class="card-header bg-primary text-white">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h5 class="mb-0">Question <span id="currentQuestionNum">1</span> of 100</h5>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <button class="btn btn-warning btn-sm" onclick="toggleFlag()" id="flagBtn">
                                        <i class="fas fa-flag me-1"></i>Flag
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <div id="questionContent" class="question-content">
                                </div>
                            <div id="optionsContent" class="mt-4">
                                </div>
                        </div>
                        <div class="card-footer">
                            <div class="row">
                                <div class="col-md-6">
                                    <button class="btn btn-secondary btn-custom" onclick="previousQuestion()" id="prevBtn">
                                        <i class="fas fa-chevron-left me-2"></i>Previous
                                    </button>
                                </div>
                                <div class="col-md-6 text-md-end">
                                    <button class="btn btn-primary btn-custom" onclick="nextQuestion()" id="nextBtn">
                                        Next<i class="fas fa-chevron-right ms-2"></i>
                                    </button>
                                    <button class="btn btn-success btn-custom" onclick="submitTest()" id="submitBtn" style="display: none;">
                                        <i class="fas fa-paper-plane me-2"></i>Submit Test
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <div class="container-fluid bg-light py-3 mt-4" data-theme-bg="secondary">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <h6 class="mb-2"><i class="fas fa-list-ol me-2"></i>Question Palette</h6>
                        <div class="question-palette" id="questionPalette">
                            </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="resultModal" tabindex="-1" data-bs-backdrop="static">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title"><i class="fas fa-trophy me-2"></i>Test Results</h5>
                    </div>
                    <div class="modal-body">
                        <div class="result-card text-center">
                            <div id="resultContent">
                                </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-center">
                        <button class="btn btn-info btn-custom me-2" onclick="showReview()">
                            <i class="fas fa-eye me-2"></i>Review Answers
                        </button>
                        <button class="btn btn-success btn-custom me-2" onclick="generateCompletePDF()">
                            <i class="fas fa-download me-2"></i>Save Complete Report as PDF
                        </button>
                        <button class="retake-btn" onclick="retakeTest()">
                            <i class="fas fa-redo me-2"></i>Retake Test
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="reviewModal" tabindex="-1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-clipboard-list me-2"></i>Answer Review</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                        <div id="reviewContent">
                            </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="bg-dark text-white text-center py-3 mt-5">
            <p class="mb-0">© 2025 Copyright UOS Mock Test Series Powered By Mock Test Hub</p>
        </footer>
    </div>

    <button class="btn btn-primary floating-btn d-none d-md-block" onclick="toggleTheme()" title="Toggle Theme">
        <i class="fas fa-adjust"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        // Global Variables
        let currentQuestion = 1;
        let totalQuestions = 100;
        let answers = {};
        let flaggedQuestions = new Set();
        let timeRemaining = 90 * 60; // 90 minutes in seconds
        let timerInterval;
        let testStartTime;
        let testEndTime;
        let currentTheme = 'light';

        // MathJax Configuration
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                ignoreHtmlClass: "tex2jax_ignore",
                processHtmlClass: "tex2jax_process"
            }
        };

        // Check if required libraries are loaded
        function checkLibraries() {
            let allLoaded = true;
            
            if (typeof window.jspdf === 'undefined' || typeof window.jspdf.jsPDF === 'undefined') {
                console.error('jsPDF library not loaded');
                allLoaded = false;
            } else {
                console.log('jsPDF library loaded successfully');
            }
            
            if (typeof window.html2canvas === 'undefined') {
                console.error('html2canvas library not loaded');
                allLoaded = false;
            } else {
                console.log('html2canvas library loaded successfully');
            }
            
            return allLoaded;
        }
        
        // Test PDF Generation (for debugging)
        function testPDFGeneration() {
            console.log('Testing PDF generation libraries...');
            
            if (!checkLibraries()) {
                alert('Required libraries are not loaded. Please check the console for details.');
                return;
            }
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                doc.text('Test PDF generation successful!', 10, 10);
                doc.save('test.pdf');
                console.log('Test PDF generated successfully');
                alert('Test PDF generated successfully! Check your downloads folder.');
            } catch (error) {
                console.error('Error in test PDF generation:', error);
                alert('Error in test PDF generation: ' + error.message);
            }
        }
        
        // Exact 100 Questions Data - Section-wise organized as provided
       const questionsData = {
  "English": [
    {
      "id": 1,
      "subject": "English",
      "topic": "Vocabulary",
      "question": "1. Synonym of BRIEF is _____________?",
      "options": ["A. Small", "B. Short", "C. Little", "D. Limited"],
      "correct": 1
    },
    {
      "id": 2,
      "subject": "English",
      "topic": "Vocabulary",
      "question": "2. Synonym of ALERT is _____________?",
      "options": ["A. Intelligent", "B. Energetic", "C. Observant", "D. Watchful"],
      "correct": 3
    },
    {
      "id": 3,
      "subject": "English",
      "topic": "Vocabulary",
      "question": "3. Synonym of negligent is _________?",
      "options": ["A. careless", "B. turn", "C. decide", "D. want"],
      "correct": 0
    },
    {
      "id": 4,
      "subject": "English",
      "topic": "Vocabulary",
      "question": "4. Synonym of Kidnap is ------ ?",
      "options": ["A. Appaling", "B. Abduct", "C. Renounce", "D. All the above"],
      "correct": 1
    },
    {
      "id": 5,
      "subject": "English",
      "topic": "Vocabulary",
      "question": "5. Synonym of 'prevalence' is _________?",
      "options": ["A. Felony", "B. Transgression", "C. Commonness", "D. Sabotage"],
      "correct": 2
    },
    {
      "id": 6,
      "subject": "English",
      "topic": "Vocabulary",
      "question": "6. Antonym of ARTIFICIAL is ______________?",
      "options": ["A. Red", "B. Solid", "C. Truthful", "D. Natural"],
      "correct": 3
    },
    {
      "id": 7,
      "subject": "English",
      "topic": "Vocabulary",
      "question": "7. Antonym of EXPAND is _____________?",
      "options": ["A. Congest", "B. Condense", "C. Conclude", "D. Convert"],
      "correct": 1
    },
    {
      "id": 8,
      "subject": "English",
      "topic": "Vocabulary",
      "question": "8. Antonym of DEVIANT is _____________?",
      "options": ["A. Bent", "B. Devious", "C. Regular", "D. Atypical"],
      "correct": 2
    },
    {
      "id": 9,
      "subject": "English",
      "topic": "Vocabulary",
      "question": "9. Antonym of Friend is _____________?",
      "options": ["A. Enemy", "B. Brother", "C. companion", "D. None of the above"],
      "correct": 0
    },
    {
      "id": 10,
      "subject": "English",
      "topic": "Vocabulary",
      "question": "10. Antonym of MINOR is ____________ ?",
      "options": ["A. Big", "B. Tall", "C. Major", "D. Heavy"],
      "correct": 2
    },
    {
      "id": 11,
      "subject": "English",
      "topic": "Spelling",
      "question": "11. Which spelling is correct?",
      "options": ["A. Encyclopedia", "B. Encyeklopedia", "C. Ensyclopedia", "D. Encycloopedia"],
      "correct": 0
    },
    {
      "id": 12,
      "subject": "English",
      "topic": "Spelling",
      "question": "12. Identify the correct Spellings:",
      "options": ["A. Temparary", "B. Temperary", "C. Temporary", "D. Temprary"],
      "correct": 2
    },
    {
      "id": 13,
      "subject": "English",
      "topic": "Spelling",
      "question": "13. Choose the word that is spelled correctly?",
      "options": ["A. Magistrate", "B. Magisterate", "C. Magistarate", "D. Maggistrate"],
      "correct": 0
    },
    {
      "id": 14,
      "subject": "English",
      "topic": "Spelling",
      "question": "14. Choose the word that is spelled correctly?",
      "options": ["A. Parlementarian", "B. Parlementerian", "C. Parliamentarian", "D. Parliamenterian"],
      "correct": 2
    },
    {
      "id": 15,
      "subject": "English",
      "topic": "Spelling",
      "question": "15. Choose the word that is spelled Correctly?",
      "options": ["A. Secretary", "B. Secertary", "C. Secartary", "D. None of these"],
      "correct": 0
    },
    {
      "id": 16,
      "subject": "English",
      "topic": "Prepositions",
      "question": "16. The whole nation was ______ the President?",
      "options": ["A. after", "B. for", "C. farther", "D. behind"],
      "correct": 3
    },
    {
      "id": 17,
      "subject": "English",
      "topic": "Prepositions",
      "question": "17. Sania resign form job ______ January?",
      "options": ["A. in", "B. on", "C. at", "D. None of these"],
      "correct": 0
    },
    {
      "id": 18,
      "subject": "English",
      "topic": "Prepositions",
      "question": "18. He is jealous ______________ her success?",
      "options": ["A. in", "B. on", "C. of", "D. about"],
      "correct": 2
    },
    {
      "id": 19,
      "subject": "English",
      "topic": "Prepositions",
      "question": "19. Maryam cares ________ the environment?",
      "options": ["A. of", "B. in", "C. about", "D. on"],
      "correct": 2
    },
    {
      "id": 20,
      "subject": "English",
      "topic": "Prepositions",
      "question": "20. The jug is full ____ milk?",
      "options": ["A. of", "B. about", "C. by", "D. with"],
      "correct": 0
    },
    {
      "id": 21,
      "subject": "English",
      "topic": "Voice",
      "question": "21. Active Voice Change into Passive; Mr. Ali asked him a question.",
      "options": ["A. He was asked a question Mr. Ali.", "B. He was asked a question to Mr. Ali.", "C. He was asked a question by Mr. Ali.", "D. A question was being asked by Mr. Ali."],
      "correct": 2
    },
    {
      "id": 22,
      "subject": "English",
      "topic": "Voice",
      "question": "22. Active Voice Change into Passive; Have you taken a rest?",
      "options": ["A. Have a rest been taken by you?", "B. Have a rest taken by you.", "C. Had a rest taken by you?", "D. Have a rest be take by you?"],
      "correct": 0
    },
    {
      "id": 23,
      "subject": "English",
      "topic": "Voice",
      "question": "23. Active Voice Change into Passive; They held a meeting very early.",
      "options": ["A. A meeting was hold by them very early.", "B. A meeting will be held by them very early.", "C. A meeting is held by them very early", "D. A meeting was held by them very early."],
      "correct": 3
    },
    {
      "id": 24,
      "subject": "English",
      "topic": "Voice",
      "question": "24. Active Voice Change into Passive; The teacher may punish you.",
      "options": ["A. You should be punished by the teacher.", "B. You shall have been punished by the teacher.", "C. You will be punished by the teacher.", "D. You may be punished by the teacher."],
      "correct": 3
    },
    {
      "id": 25,
      "subject": "English",
      "topic": "Voice",
      "question": "25. Active Voice Change into Passive; People speak English all over the world.",
      "options": ["A. English is spoken all over the world.", "B. English is spoken by people.", "C. English was spoken by people.", "D. English was spoken all over the world."],
      "correct": 0
    },
    {
      "id": 26,
      "subject": "English",
      "topic": "Narration",
      "question": "26. Change the narration of (He said to the Judge, 'I did not commit this crime.')",
      "options": ["A. He told the Judge that he did not commit the crime.", "B. He told the judge that he had not committed the crime.", "C. He told the judge that he had not committed that crime.", "D. He told the judge that he had not committed this crime"],
      "correct": 2
    },
    {
      "id": 27,
      "subject": "English",
      "topic": "Narration",
      "question": "27. Change the narration. Aliya said, 'I have already written a letter to my family.'",
      "options": ["A. Aliya said that she had already written a letter to her family.", "B. Aliya said that she has already written a letter to her family.", "C. Aliya said that she has already been written a letter to her family.", "D. Aliya said that she had already been written a letter to her family."],
      "correct": 0
    },
    {
      "id": 28,
      "subject": "English",
      "topic": "Narration",
      "question": "28. Change the narration. He said, 'The sun is stationary'.",
      "options": ["A. He said the sun is stationary.", "B. He said that the sun is stationary.", "C. He said that the sun was stationary.", "D. None of these"],
      "correct": 1
    },
    {
      "id": 29,
      "subject": "English",
      "topic": "Narration",
      "question": "29. Change the narration. I asked him where he would stay.",
      "options": ["A. I said to him 'Where you will stay ?'", "B. I asked him 'Where will you stay?'", "C. I said to him 'Where I will stay ?'", "D. I said to him 'Where will I stay ?'"],
      "correct": 1
    },
    {
      "id": 30,
      "subject": "English",
      "topic": "Narration",
      "question": "30. He said to me, 'I expect you to attend the function.'",
      "options": ["A. He told me that he had expected me to attend the function.", "B. He told me that he expected me to attend the function.", "C. He told me that he expected me to attended the function.", "D. He told me that he expected me to have attended the function."],
      "correct": 1
    }
  ],
  "General Knowledge": [
    {
      "id": 31,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "31. What does the CPEC stands for ?",
      "options": ["A. China Pakistan Electrical Coal", "B. China Pakistan Electronics Corporation", "C. China Pakistan Economic Corridor", "D. China Portagal Economical Corporation"],
      "correct": 2
    },
    {
      "id": 32,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "32. What is the Capital city of Bangladesh?",
      "options": ["A. New Delhi", "B. Beijing", "C. Neypidya", "D. Dhaka"],
      "correct": 3
    },
    {
      "id": 33,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "33. Which pass connects Pakistan with Afghanistan?",
      "options": ["A. Gomal Pass", "B. Khyber Pass", "C. Tochi Pass", "D. Khunjerab Pass"],
      "correct": 1
    },
    {
      "id": 34,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "34. Who was the founder of Daily English Newspaper Dawn?",
      "options": ["A. Liaquat Ali Khan", "B. Z.A Sulehri", "C. Quaid-e-Azam", "D. None of them"],
      "correct": 2
    },
    {
      "id": 35,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "35. The Muslims came to Sindh in 712 A.D.under the leadership of?",
      "options": ["A. Mahmood Ghaznavi", "B. Zaheer-ud-Din Baber", "C. Muhammad Bin Qasim", "D. NOT"],
      "correct": 2
    },
    {
      "id": 36,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "36. The name of poet whose collection of poetry is called 'Shah jo Risalu'?",
      "options": ["A. Khushal Khan Khattak", "B. Waris Shah", "C. Makhdum Muhammad Hashim", "D. Shah Abdul Latif Bhatai"],
      "correct": 3
    },
    {
      "id": 37,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "37. What was the old name of Hyderabad?",
      "options": ["A. Shal Kot", "B. Neeron Kot", "C. Ramkot", "D. Akmol Pur"],
      "correct": 1
    },
    {
      "id": 38,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "38. Shrine of Lal Shahbaz Qalandar located in which district?",
      "options": ["A. Sehwan", "B. Hyderabad", "C. Jamshoro", "D. None of these"],
      "correct": 2
    },
    {
      "id": 39,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "39. Which country hosted the champion trophy 2025?",
      "options": ["A. Pakistan", "B. India", "C. Australia", "D. England"],
      "correct": 0
    },
    {
      "id": 40,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "40. One of the oldest University of Pakistan Located in Sindh ______?",
      "options": ["A. University of Sindh", "B. Karachi University", "C. Liaquat Medical University", "D. Agriculture University"],
      "correct": 0
    },
    {
      "id": 41,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "41. What is the capital of France?",
      "options": ["A. London", "B. Rome", "C. Berlin", "D. Paris"],
      "correct": 3
    },
    {
      "id": 42,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "42. What is the date of birth of Quaid-e-Azam?",
      "options": ["A. December 25, 1876", "B. September 11, 1878", "C. December 21, 1876", "D. September 25, 1878"],
      "correct": 0
    },
    {
      "id": 43,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "43. What is the largest ocean on Earth?",
      "options": ["A. Arctic Ocean", "B. Indian Ocean", "C. Pacific Ocean", "D. Atlantic Ocean"],
      "correct": 2
    },
    {
      "id": 44,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "44. Which country is known as the 'Land of the Rising Sun'?",
      "options": ["A. China", "B. Japan", "C. South Korea", "D. Vietnam"],
      "correct": 1
    },
    {
      "id": 45,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "45. Who is the Current Foreign Minister of Pakistan?",
      "options": ["A. Bilawal Bhutto Zardari", "B. Shah Mehmood Qureshi", "C. Khawaja Asif", "D. None of These"],
      "correct": 3
    },
    {
      "id": 46,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "46. How many districts are in Sindh ?",
      "options": ["A. 25", "B. 27", "C. 29", "D. 30"],
      "correct": 3
    },
    {
      "id": 47,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "47. Senate of Pakistan comprises of how many members?",
      "options": ["A. 50", "B. 63", "C. 87", "D. 100"],
      "correct": 3
    },
    {
      "id": 48,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "48. Which country is the world's largest producer of coffee ?",
      "options": ["A. Taiwan", "B. UK", "C. Brazil", "D. Switzerland"],
      "correct": 2
    },
    {
      "id": 49,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "49. Which is the highest mountain in the world?",
      "options": ["A. K_2", "B. Everest", "C. Nanga Parbat", "D. Siachen"],
      "correct": 1
    },
    {
      "id": 50,
      "subject": "General Knowledge",
      "topic": "World & History",
      "question": "50. Tarbela dam is situated in _________ ?",
      "options": ["A. Kashmir", "B. KPK", "C. FATA", "D. Gilgit Baltistan"],
      "correct": 1
    }
  ],
  "Science": [
    {
      "id": 51,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "51. Which is the outermost planet in the solar system?",
      "options": ["A. Mercury", "B. Pluto", "C. Neptune", "D. Uranus"],
      "correct": 2
    },
    {
      "id": 52,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "52. The SI unit of charge is __________?",
      "options": ["A. Ampere", "B. Coulomb", "C. Ohm", "D. Volt"],
      "correct": 1
    },
    {
      "id": 53,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "53. The most abundant element in the universe is __________.",
      "options": ["A. Oxygen", "B. Carbon Dioxide", "C. Silicon", "D. Hydrogen"],
      "correct": 3
    },
    {
      "id": 54,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "54. Deficiency of Vitamin-A results in __________?",
      "options": ["A. Night blindness", "B. rickets", "C. hair fall", "D. scurvy"],
      "correct": 0
    },
    {
      "id": 55,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "55. The fluid part of blood is known as __________?",
      "options": ["A. plasma", "B. platelets", "C. blood cells", "D. None of these"],
      "correct": 0
    },
    {
      "id": 56,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "56. Oxidation is a chemical reaction involving the __________?",
      "options": ["A. Gain of Electrons", "B. Loss of Electrons", "C. Gain of Protons", "D. Loss of Protons"],
      "correct": 1
    },
    {
      "id": 57,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "57. Digestion of food is completed in the __________?",
      "options": ["A. small intestine", "B. large intestine", "C. stomach", "D. Liver"],
      "correct": 0
    },
    {
      "id": 58,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "58. The SI unit of Heat is________?",
      "options": ["A. Mercury", "B. Newton", "C. Volt", "D. Joule"],
      "correct": 3
    },
    {
      "id": 59,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "59. ECG is used for the diagnosis of aliments of ?",
      "options": ["A. Brain", "B. Heart", "C. Kidneys", "D. Lungs"],
      "correct": 1
    },
    {
      "id": 60,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "60. How many bones are there in a newly born infant?",
      "options": ["A. 206", "B. 230", "C. 280", "D. 300"],
      "correct": 3
    },
    {
      "id": 61,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "61. Malaria is a disease which effects the____________?",
      "options": ["A. Heart", "B. Lungs", "C. Kidneys", "D. Spleen"],
      "correct": 3
    },
    {
      "id": 62,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "62. All matter is made of ___________?",
      "options": ["A. Air", "B. Water", "C. Vibrations", "D. Atoms"],
      "correct": 3
    },
    {
      "id": 63,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "63. ____________ have no charge?",
      "options": ["A. Neutrons", "B. Protons", "C. Electrons", "D. None of These"],
      "correct": 0
    },
    {
      "id": 64,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "64. Electron was discovered by?",
      "options": ["A. Michael Faraday", "B. Yuri Gagarin", "C. J.J Thomson", "D. James Maxwell"],
      "correct": 2
    },
    {
      "id": 65,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "65. Sunlight is a Great Source of ____________?",
      "options": ["A. vitamin C", "B. vitamin D", "C. vitamin E", "D. Vitamin K"],
      "correct": 1
    },
    {
      "id": 66,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "66. The longest bone in human body is___________?",
      "options": ["A. Ulna", "B. Femur", "C. Humerus", "D. Tibia"],
      "correct": 1
    },
    {
      "id": 67,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "67. Dr. Abdul Qadeer Khan, the nuclear scientist of Pakistan and pioneer of first atomic bomb of Muslim World died on_________?",
      "options": ["A. 10th October, 2021", "B. 9th October, 2021", "C. 8th October, 2021", "D. None of these"],
      "correct": 0
    },
    {
      "id": 68,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "68. Chemical formula for Water is _______ ?",
      "options": ["A. NaAlO2", "B. Al2O3", "C. CaSiO3", "D. H2O"],
      "correct": 3
    },
    {
      "id": 69,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "69. What is the chemical formula for Sulfuric acid?",
      "options": ["A. C2H6O", "B. H2SO4", "C. C2H4O2", "D. CaSO4"],
      "correct": 1
    },
    {
      "id": 70,
      "subject": "Science",
      "topic": "Science Principles",
      "question": "70. The branch of science which deals with the properties of matter and energy is called__________?",
      "options": ["A. Biology", "B. Geography", "C. Physics", "D. Chemistry"],
      "correct": 2
    }
  ],
  "Mathematics": [
    {
      "id": 71,
      "subject": "Mathematics",
      "topic": "Problem Solving",
      "question": "71. Ali purchased a plot for Rs. 8,000. He sells the plot to Sajid at a profit of 20%. Sajid in turn sells that plot to Zahid at a loss of 20%. The plot costs Zahid ?",
      "options": ["A. Rs. 12,000", "B. Rs. 10,000", "C. Rs. 8670", "D. Rs. 7680"],
      "correct": 3
    },
    {
      "id": 72,
      "subject": "Mathematics",
      "topic": "Arithmetic",
      "question": "72. The average of first 10 odd numbers is_____________?",
      "options": ["A. 10", "B. 9", "C. 12", "D. 17"],
      "correct": 0
    },
    {
      "id": 73,
      "subject": "Mathematics",
      "topic": "Problem Solving",
      "question": "73. The average age 9 members of a committee are the same as it was 2 years ago, because an old number has been replaced by a younger number. Find how much younger is the new member than the old number?",
      "options": ["A. 7 years", "B. 11 years", "C. 18 years", "D. 27 years"],
      "correct": 2
    },
    {
      "id": 74,
      "subject": "Mathematics",
      "topic": "Arithmetic",
      "question": "74. The average of 10 numbers is 23. If each number is increased by 4, what will the new average?",
      "options": ["A. 22", "B. 27", "C. 25", "D. 29"],
      "correct": 1
    },
    {
      "id": 75,
      "subject": "Mathematics",
      "topic": "Arithmetic",
      "question": "75. Shayan bought 65 books for Rs.1150 from one shop and 50 books for Rs.920 from another. What is the average price he paid per book ?",
      "options": ["A. Rs.18", "B. Rs.20", "C. Rs.16", "D. Rs.22"],
      "correct": 0
    },
    {
      "id": 76,
      "subject": "Mathematics",
      "topic": "Arithmetic",
      "question": "76. Find the average of all the numbers between 6 and 34 which are divisible by 5.",
      "options": ["A. 18", "B. 20", "C. 24", "D. 30"],
      "correct": 1
    },
    {
      "id": 77,
      "subject": "Mathematics",
      "topic": "Arithmetic",
      "question": "77. The average of first five multiples of 3 is____________?",
      "options": ["A. 3", "B. 15", "C. 12", "D. 9"],
      "correct": 3
    },
    {
      "id": 78,
      "subject": "Mathematics",
      "topic": "Percentages",
      "question": "78. A dealer marks his goods 20% above cost price. He then allows some discount on it and makes a profit of 8%. The rate of discount is:",
      "options": ["A. 12%", "B. 10%", "C. 6%", "D. 4%"],
      "correct": 1
    },
    {
      "id": 79,
      "subject": "Mathematics",
      "topic": "Percentages",
      "question": "79. A trader bought a car at 20% discount on its original price. He sold it at a 40% increase on the price he bought it. What percent of profit did he make on the original price?",
      "options": ["A. 10%", "B. 11%", "C. 12%", "D. 15%"],
      "correct": 2
    },
    {
      "id": 80,
      "subject": "Mathematics",
      "topic": "Algebra",
      "question": "80. Find two number whose sum is 28 and the difference is 4 _____________?",
      "options": ["A. 12,16", "B. 18,10", "C. 15,13", "D. 14,12"],
      "correct": 0
    },
    {
      "id": 81,
      "subject": "Mathematics",
      "topic": "Problem Solving",
      "question": "81. Today is Emaan's birthday. After one year, she will become two times as she was ten years ago. current age of Emaan?",
      "options": ["A. 18", "B. 19", "C. 20", "D. 21"],
      "correct": 3
    },
    {
      "id": 82,
      "subject": "Mathematics",
      "topic": "Problem Solving",
      "question": "82. If 3 men or 4 women can construct a wall in 43 days, then the number of days that 7 men and 5 women take to construct it is :",
      "options": ["A. 12 days", "B. 14 days", "C. 16 days", "D. 18 days"],
      "correct": 0
    },
    {
      "id": 83,
      "subject": "Mathematics",
      "topic": "Problem Solving",
      "question": "83. If 10 workers can make 10 tables in 10 days, then how many days would it take for 5 workers to make 5 tables?",
      "options": ["A. 1", "B. 5", "C. 10", "D. 25"],
      "correct": 2
    },
    {
      "id": 84,
      "subject": "Mathematics",
      "topic": "Problem Solving",
      "question": "84. If 6 men take 9 days to complete a work, how many men can complete the work in 3 days?",
      "options": ["A. 2 men", "B. 12 men", "C. 9 men", "D. 18 men"],
      "correct": 3
    },
    {
      "id": 85,
      "subject": "Mathematics",
      "topic": "Percentages",
      "question": "85. What percent of 120 are 90?",
      "options": ["A. 25%", "B. 50%", "C. 75%", "D. 33%"],
      "correct": 2
    },
    {
      "id": 86,
      "subject": "Mathematics",
      "topic": "Algebra",
      "question": "86. Find the number which when multiplied by 15 is increased by 196.",
      "options": ["A. 14", "B. 20", "C. 26", "D. 28"],
      "correct": 0
    },
    {
      "id": 87,
      "subject": "Mathematics",
      "topic": "Arithmetic",
      "question": "87. 64309 – 8703 + 798 – 437 = ________?",
      "options": ["A. 55606", "B. 55697", "C. 55967", "D. 73373"],
      "correct": 2
    },
    {
      "id": 88,
      "subject": "Mathematics",
      "topic": "Arithmetic",
      "question": "88. 22004 – 29303 + 101299 – 59532 = _________?",
      "options": ["A. 44000", "B. 24500", "C. 26000", "D. 34500"],
      "correct": 3
    },
    {
      "id": 89,
      "subject": "Mathematics",
      "topic": "Problem Solving",
      "question": "89. The average age of a husband, wife and their child 3 years ago was 27 years and that of wife and the child 5 years ago was 20 years. The present age of the husband is___________?",
      "options": ["A. 35 years", "B. 40 year", "C. 30 year", "D. None of these"],
      "correct": 1
    },
    {
      "id": 90,
      "subject": "Mathematics",
      "topic": "Number Systems",
      "question": "90. 1 (one) is a ____ number?",
      "options": ["A. Prime", "B. Composite", "C. Even", "D. None"],
      "correct": 3
    }
  ],
  "I.Q": [
    {
      "id": 91,
      "subject": "I.Q",
      "topic": "Logical Reasoning",
      "question": "91. year is to month as week is to…..?",
      "options": ["A. Hour", "B. day", "C. fortnight", "D. minute"],
      "correct": 1
    },
    {
      "id": 92,
      "subject": "I.Q",
      "topic": "Logical Reasoning",
      "question": "92. Blindness is to eye as deafness is to …..?",
      "options": ["A. brain", "B. nose", "C. head", "D. ear"],
      "correct": 3
    },
    {
      "id": 93,
      "subject": "I.Q",
      "topic": "Logical Reasoning",
      "question": "93. food is to eat as water is to …..?",
      "options": ["A. wash", "B. dirt", "C. drink", "D. fire"],
      "correct": 2
    },
    {
      "id": 94,
      "subject": "I.Q",
      "topic": "Logical Reasoning",
      "question": "94. Teacher is to students as doctor is to …..?",
      "options": ["A. Medicine", "B. Drugs", "C. Patients", "D. hospital"],
      "correct": 2
    },
    {
      "id": 95,
      "subject": "I.Q",
      "topic": "Logical Reasoning",
      "question": "95. hot is to steam as cold is to …..?",
      "options": ["A. Ice", "B. Water", "C. weather", "D. NOT"],
      "correct": 0
    },
    {
      "id": 96,
      "subject": "I.Q",
      "topic": "Logical Reasoning",
      "question": "96. What will come at the place of question mark ? 1, 9, 25, 49, ? , 121.",
      "options": ["A. 100", "B. 91", "C. 64", "D. 81"],
      "correct": 3
    },
    {
      "id": 97,
      "subject": "I.Q",
      "topic": "Logical Reasoning",
      "question": "97. What will come at the place of question mark ? 4, 7, 12, 19, 28, ?",
      "options": ["A. 49", "B. 39", "C. 36", "D. 30"],
      "correct": 1
    },
    {
      "id": 98,
      "subject": "I.Q",
      "topic": "Logical Reasoning",
      "question": "98. What will come at the place of question mark ? 10, 100, 200, 310, ?",
      "options": ["A. 430", "B. 420", "C. 410", "D. 400"],
      "correct": 0
    },
    {
      "id": 99,
      "subject": "I.Q",
      "topic": "Logical Reasoning",
      "question": "99. Find the missing term: 2, 3, 5, 7, 11, ?, 17.",
      "options": ["A. 12", "B. 13", "C. 14", "D. 15"],
      "correct": 1
    },
    {
      "id": 100,
      "subject": "I.Q",
      "topic": "Logical Reasoning",
      "question": "100. 'Glove' is related to 'Hand' in the same way as 'Cap' is related to. ?",
      "options": ["A. Foot", "B. Neck", "C. Head", "D. NoT"],
      "correct": 2
    }
  ]

};
        const allQuestions = [];
        Object.values(questionsData).forEach(sectionQuestions => {
            allQuestions.push(...sectionQuestions);
        });
        
        // Make questionsData globally accessible
        window.questionsData = questionsData;
        window.allQuestions = allQuestions;

        // Initialize Test
        $(document).ready(function() {
            $('#passwordModal').modal('show');
            generateQuestionPalette();
            initializeTheme();
            adjustForMobile(); // Add mobile adjustments on load
            
            // Check if required libraries are loaded
            setTimeout(() => {
                if (!checkLibraries()) {
                    console.warn('Some required libraries failed to load. PDF generation may not work properly.');
                }
            }, 3000);
        });

        // Password Verification
        function verifyPassword() {
            const password = document.getElementById('passwordInput').value;
            const correctPassword = 'uostestbymk';
            
            if (password === correctPassword) {
                // Hide modal and show main content
                const passwordModal = bootstrap.Modal.getInstance(document.getElementById('passwordModal'));
                if (passwordModal) {
                    passwordModal.hide();
                }
                // Ensure main content is visible
                document.getElementById('mainContent').style.display = 'block';
                startTest();
            } else {
                document.getElementById('passwordError').textContent = 'Incorrect password. Please try again.';
                document.getElementById('passwordInput').classList.add('is-invalid');
                document.getElementById('passwordInput').value = '';
                
                // Add shake animation to indicate error
                const modalContent = document.querySelector('#passwordModal .modal-content');
                if (modalContent) {
                    modalContent.classList.add('animate__shakeX');
                    
                    // Remove animation class after it completes
                    setTimeout(() => {
                        modalContent.classList.remove('animate__shakeX');
                    }, 1000);
                }
            }
        }

        // Enter key for password
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                verifyPassword();
            }
        });

        // Start Test
        function startTest() {
            console.log("Starting test...");
            console.log("All questions:", allQuestions);
            testStartTime = new Date();
            startTimer();
            loadQuestion(1);
        }

        // Timer Functions
        function startTimer() {
            timerInterval = setInterval(function() {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    autoSubmitTest();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Change timer color when time is running out
            if (timeRemaining <= 300) { // 5 minutes
                document.getElementById('timer').style.background = 'linear-gradient(45deg, #dc3545, #c82333)';
            }
        }

        // Generate Question Palette
        function generateQuestionPalette() {
            const palette = document.getElementById('questionPalette');
            palette.innerHTML = '';
            
            for (let i = 1; i <= totalQuestions; i++) {
                const button = document.createElement('button');
                button.className = 'question-number btn d-inline-flex align-items-center justify-content-center me-2 mb-2';
                button.textContent = i;
                button.onclick = () => loadQuestion(i);
                palette.appendChild(button);
            }
        }

        // Load Question
        function loadQuestion(questionNum) {
            console.log("Loading question:", questionNum);
            if (!allQuestions || questionNum < 1 || questionNum > allQuestions.length) {
                console.error("Invalid question number:", questionNum);
                return;
            }
            currentQuestion = questionNum;
            const question = allQuestions[questionNum - 1];
            
            document.getElementById('currentQuestionNum').textContent = questionNum;
            
            // Update question content using string concatenation to avoid template string issues
            document.getElementById('questionContent').innerHTML = 
                '<h6><span class="badge bg-info me-2">' + question.subject + '</span>' + question.topic + '</h6>' +
                '<p class="lead">' + question.question + '</p>';
            
            // Update options
            let optionsHTML = '';
            question.options.forEach((option, index) => {
                const isSelected = answers[questionNum] === (index + 1) ? 'selected' : '';
                optionsHTML += '<div class="option-card ' + isSelected + '" onclick="selectOption(' + (index + 1) + ')">' +
                    option + '</div>';
            });
            document.getElementById('optionsContent').innerHTML = optionsHTML;
            
            // Update navigation buttons
            document.getElementById('prevBtn').style.display = questionNum === 1 ? 'none' : 'inline-block';
            document.getElementById('nextBtn').style.display = questionNum === totalQuestions ? 'none' : 'inline-block';
            document.getElementById('submitBtn').style.display = questionNum === totalQuestions ? 'inline-block' : 'none';
            
            // Update flag button
            const flagBtn = document.getElementById('flagBtn');
            if (flaggedQuestions.has(questionNum)) {
                flagBtn.innerHTML = '<i class="fas fa-flag me-1"></i>Unflag';
                flagBtn.className = 'btn btn-danger btn-sm';
            } else {
                flagBtn.innerHTML = '<i class="fas fa-flag me-1"></i>Flag';
                flagBtn.className = 'btn btn-warning btn-sm';
            }
            
            updateQuestionPalette();
            
            // Render MathJax with better error handling
            if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                // Add a small delay to ensure DOM is updated before rendering
                setTimeout(() => {
                    MathJax.typesetPromise().then(() => {
                        console.log('MathJax rendered successfully for question ' + questionNum);
                    }).catch(function (err) {
                        console.log('MathJax typeset error for question ' + questionNum + ': ' + err.message);
                        // Try again after a longer delay
                        setTimeout(() => {
                            MathJax.typesetPromise().catch(function (err2) {
                                console.log('Second MathJax attempt failed for question ' + questionNum + ': ' + err2.message);
                            });
                        }, 500);
                    });
                }, 100);
            }
            
            // Add fade-in animation
            document.getElementById('questionCard').classList.add('fade-in');
            setTimeout(() => {
                document.getElementById('questionCard').classList.remove('fade-in');
            }, 500);
        }

        // Select Option
        function selectOption(optionNum) {
            answers[currentQuestion] = optionNum;
            
            // Update option display
            document.querySelectorAll('.option-card').forEach((card, index) => {
                card.classList.remove('selected');
                if (index + 1 === optionNum) {
                    card.classList.add('selected');
                }
            });
            
            updateQuestionPalette();
        }

        // Update Question Palette
        function updateQuestionPalette() {
            const buttons = document.querySelectorAll('.question-number');
            buttons.forEach((button, index) => {
                const questionNum = index + 1;
                button.classList.remove('current', 'answered', 'flagged');
                
                if (questionNum === currentQuestion) {
                    button.classList.add('current');
                } else if (answers[questionNum]) {
                    button.classList.add('answered');
                }
                
                if (flaggedQuestions.has(questionNum)) {
                    button.classList.add('flagged');
                }
            });
        }

        // Navigation Functions
        function previousQuestion() {
            if (currentQuestion > 1) {
                loadQuestion(currentQuestion - 1);
            }
        }

        function nextQuestion() {
            if (currentQuestion < totalQuestions) {
                loadQuestion(currentQuestion + 1);
            }
        }

        // Flag Question
        function toggleFlag() {
            if (flaggedQuestions.has(currentQuestion)) {
                flaggedQuestions.delete(currentQuestion);
            } else {
                flaggedQuestions.add(currentQuestion);
            }
            loadQuestion(currentQuestion);
        }

        // Submit Test
        function submitTest() {
            console.log("Submit test function called");
            if (confirm('Are you sure you want to submit the test? You cannot change your answers after submission.')) {
                console.log("User confirmed submission");
                testEndTime = new Date();
                clearInterval(timerInterval);
                calculateResults();
            } else {
                console.log("User cancelled submission");
            }
        }

        function autoSubmitTest() {
            testEndTime = new Date();
            alert('Time\'s up! Test will be submitted automatically.');
            calculateResults();
        }

        // ==========================================================
        // ===== CORRECTED CODE: calculateResults Function ==========
        // ==========================================================
        function calculateResults() {
            console.log("Calculate results function called");
            let correctAnswers = 0;
            let totalAttempted = Object.keys(answers).length;
            
            allQuestions.forEach(question => {
                // FIX: Convert the 1-based user answer to a 0-based index for comparison.
                // For example, if user chose option 1, answers[question.id] is 1.
                // (1 - 1) is 0, which correctly matches question.correct if it's the first option.
                if ((answers[question.id] - 1) === question.correct) {
                    correctAnswers++;
                }
            });
            
            const obtainedMarks = correctAnswers;
            const totalMarks = 100;
            const passingMarks = 50;
            const isPassed = obtainedMarks >= passingMarks;
            const timeTaken = Math.floor((testEndTime - testStartTime) / 1000);
            
            // Store results globally
            window.testResults = {
                obtainedMarks,
                totalMarks,
                passingMarks,
                isPassed,
                correctAnswers,
                totalAttempted,
                timeTaken,
                answers,
                flaggedQuestions: Array.from(flaggedQuestions)
            };
            
            console.log("Results calculated:", window.testResults);
            displayResults();
        }

        function displayResults() {
            const results = window.testResults;
            const minutes = Math.floor(results.timeTaken / 60);
            const seconds = results.timeTaken % 60;
            
            // Use string concatenation instead of template strings
            const resultHTML = 
                '<div class="row text-center">' +
                    '<div class="col-md-4 mb-3">' +
                        '<h2 class="display-4">' + results.obtainedMarks + '</h2>' +
                        '<p class="mb-0">Marks Obtained</p>' +
                    '</div>' +
                    '<div class="col-md-4 mb-3">' +
                        '<h2 class="display-4">' + results.totalMarks + '</h2>' +
                        '<p class="mb-0">Total Marks</p>' +
                    '</div>' +
                    '<div class="col-md-4 mb-3">' +
                        '<h2 class="display-4 ' + (results.isPassed ? 'text-success' : 'text-danger') + '">' +
                            (results.isPassed ? 'PASS' : 'FAIL') +
                        '</h2>' +
                        '<p class="mb-0">Result Status</p>' +
                    '</div>' +
                '</div>' +
                '<hr class="my-4">' +
                '<div class="row text-center">' +
                    '<div class="col-md-6">' +
                        '<h5><i class="fas fa-clock me-2"></i>Time Taken</h5>' +
                        '<p class="lead">' + minutes + ':' + seconds.toString().padStart(2, '0') + ' minutes</p>' +
                    '</div>' +
                    '<div class="col-md-6">' +
                        '<h5><i class="fas fa-percentage me-2"></i>Percentage</h5>' +
                        '<p class="lead">' + results.obtainedMarks + '%</p>' +
                    '</div>' +
                '</div>';
            
            document.getElementById('resultContent').innerHTML = resultHTML;
            
            // Ensure Bootstrap modal is properly initialized and shown
            const resultModal = new bootstrap.Modal(document.getElementById('resultModal'));
            resultModal.show();
            
            console.log("Result modal should be shown now");
        }

        // Retake Test Function
        function retakeTest() {
            if (confirm('Are you sure you want to retake the test? This will reset all your current answers.')) {
                // Reset all test variables
                currentQuestion = 1;
                answers = {};
                flaggedQuestions = new Set();
                timeRemaining = 90 * 60; // Reset to 90 minutes
                
                // Clear timer
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
                
                // Hide result modal
                const resultModal = bootstrap.Modal.getInstance(document.getElementById('resultModal'));
                if (resultModal) {
                    resultModal.hide();
                }
                
                // Reset UI
                generateQuestionPalette();
                
                // Start fresh test
                setTimeout(() => {
                    startTest();
                }, 500);
            }
        }

        // ========================================================
        // ===== CORRECTED CODE: showReview Function ==============
        // ========================================================
        function showReview() {
            const results = window.testResults;
            let reviewHTML = '';
            
            // Generate review content section-wise
            const sectionOrder = ['English', 'General Knowledge', 'Science', 'Mathematics', 'I.Q'];
            
            for (const sectionName of sectionOrder) {
                // Skip if section doesn't exist in questionsData
                if (!questionsData[sectionName]) {
                    console.warn(`Section "${sectionName}" not found in questionsData`);
                    continue;
                }
                
                const sectionQuestions = questionsData[sectionName];
                
                // Section Header
                reviewHTML += `
                    <div class="mb-4">
                        <h4 class="text-primary border-bottom pb-2">
                            <i class="fas fa-book-open me-2"></i>${sectionName}
                        </h4>
                `;
                
                sectionQuestions.forEach(question => {
                    const userAnswer = results.answers[question.id];
                    // FIX 1: Correctly check if the answer is right using the same logic as calculateResults.
                    const isCorrect = (userAnswer - 1) === question.correct;
                    const isAttempted = userAnswer !== undefined;
                    
                    let statusClass, statusIcon, statusText;
                    if (!isAttempted) {
                        statusClass = 'review-unattempted';
                        statusIcon = 'fas fa-minus-circle text-secondary';
                        statusText = 'Not Attempted';
                    } else if (isCorrect) {
                        statusClass = 'review-correct';
                        statusIcon = 'fas fa-check-circle text-success';
                        statusText = 'Correct';
                    } else {
                        statusClass = 'review-incorrect';
                        statusIcon = 'fas fa-times-circle text-danger';
                        statusText = 'Incorrect';
                    }
                    
                    reviewHTML += `
                        <div class="card mb-3 ${statusClass}">
                            <div class="card-header">
                                <div class="row align-items-center">
                                    <div class="col-md-6">
                                        <h6 class="mb-0">Question ${question.id}</h6>
                                        <small class="text-muted">${question.topic}</small>
                                    </div>
                                    <div class="col-md-6 text-md-end">
                                        <span class="badge bg-secondary">
                                            <i class="${statusIcon} me-1"></i>${statusText}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <p><strong>Question:</strong> ${question.question}</p>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Your Answer:</strong> 
                                            ${userAnswer ? question.options[userAnswer - 1] : 'Not Attempted'}
                                        </p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Correct Answer:</strong> 
                                                                                      ${question.options[question.correct]}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                reviewHTML += '</div>'; // Close section
            }
            
            document.getElementById('reviewContent').innerHTML = reviewHTML;
            
            // Show review modal using Bootstrap JS
            const reviewModal = new bootstrap.Modal(document.getElementById('reviewModal'));
            reviewModal.show();
            
            // Render MathJax for review
            if (window.MathJax) {
                MathJax.typesetPromise().catch(function (err) {
                    console.log('MathJax typeset error in review: ' + err.message);
                });
            }
        }

                // Complete PDF Generation - WITHOUT Question Palette
        async function generateCompletePDF() {
            // Show progress modal
            document.getElementById('pdfProgress').style.display = 'flex';
            updateProgress(0, 'Initializing PDF generation...');
            
            try {
                console.log('Starting PDF generation...');
                
                // Check if required libraries are loaded
                if (!checkLibraries()) {
                    throw new Error('Required libraries (jsPDF, html2canvas) are not loaded properly. Please refresh the page and try again.');
                }
                
                // Check if jsPDF is properly loaded
                if (!window.jspdf || !window.jspdf.jsPDF) {
                    throw new Error('jsPDF library not loaded properly. Please refresh the page and try again.');
                }
                
                const { jsPDF } = window.jspdf;
                
                // Test if we can create a jsPDF instance
                let doc;
                try {
                    doc = new jsPDF('p', 'mm', 'a4');
                    console.log('jsPDF instance created successfully');
                } catch (pdfError) {
                    throw new Error('Failed to create PDF document: ' + pdfError.message);
                }
                
                // Check if test results are available
                if (!window.testResults) {
                    throw new Error('Test results not available. Please complete the test first.');
                }
                
                // Check if questions data is available
                if (!window.questionsData) {
                    throw new Error('Questions data not available. Please refresh the page and try again.');
                }
                
                const results = window.testResults;
                console.log('Test results available:', results);
                
                const obtainedMarks = results.obtainedMarks;
                const totalMarks = results.totalMarks;
                const percentage = obtainedMarks;
                const grade = obtainedMarks >= 50 ? 'Pass' : 'Fail';
                const remarks = obtainedMarks >= 80 ? 'Excellent!' : 
                               obtainedMarks >= 70 ? 'Very Good' : 
                               obtainedMarks >= 60 ? 'Good' : 
                               obtainedMarks >= 50 ? 'Satisfactory' : 'Needs Improvement';
                
                const questionsData = window.questionsData;
                console.log('Questions data available:', questionsData);
                
                const pageWidth = doc.internal.pageSize.width;
                const pageHeight = doc.internal.pageSize.height;
                const margin = 15;
                const lineHeight = 6;
                let yPos = margin;
                
                // Helper function to add new page
                function addNewPage() {
                    doc.addPage();
                    yPos = margin + 10;
                }
                
                // Helper function to check page overflow
                function checkPageOverflow(requiredSpace = 25) {
                    if (yPos + requiredSpace > pageHeight - margin) {
                        addNewPage();
                        return true;
                    }
                    return false;
                }
                
                // Helper function to clean LaTeX for plain text
                function cleanLatexText(text) {
                    if (!text) return '';
                    return text
                        .replace(/\\\(/g, '')
                        .replace(/\\\)/g, '')
                        .replace(/\\\[/g, '')
                        .replace(/\\\]/g, '')
                        .replace(/\\frac\{([^}]+)\}\{([^}]+)\}/g, '($1)/($2)')
                        .replace(/\\sqrt\{([^}]+)\}/g, 'sqrt($1)')
                        .replace(/\\pi/g, 'π')
                        .replace(/\\theta/g, 'θ')
                        .replace(/\\alpha/g, 'α')
                        .replace(/\\beta/g, 'β')
                        .replace(/\\gamma/g, 'γ')
                        .replace(/\\delta/g, 'δ')
                        .replace(/\\epsilon/g, 'ε')
                        .replace(/\\phi/g, 'φ')
                        .replace(/\\lambda/g, 'λ')
                        .replace(/\\mu/g, 'μ')
                        .replace(/\\sigma/g, 'σ')
                        .replace(/\\omega/g, 'ω')
                        .replace(/\\Omega/g, 'Ω')
                        .replace(/\\times/g, '×')
                        .replace(/\\cdot/g, '·')
                        .replace(/\\rightarrow/g, '→')
                        .replace(/\\leftarrow/g, '←')
                        .replace(/\\rightleftharpoons/g, '⇌')
                        .replace(/\\infty/g, '∞')
                        .replace(/\\pm/g, '±')
                        .replace(/\\leq/g, '≤')
                        .replace(/\\geq/g, '≥')
                        .replace(/\\neq/g, '≠')
                        .replace(/\\approx/g, '≈')
                        .replace(/\\int/g, '∫')
                        .replace(/\\sum/g, 'Σ')
                        .replace(/\\prod/g, 'Π')
                        .replace(/\\lim/g, 'lim')
                        .replace(/\\log/g, 'log')
                        .replace(/\\ln/g, 'ln')
                        .replace(/\\sin/g, 'sin')
                        .replace(/\\cos/g, 'cos')
                        .replace(/\\tan/g, 'tan')
                        .replace(/\\mathbb\{([^}]+)\}/g, '$1')
                        .replace(/\\setminus/g, '\\')
                        .replace(/\\\\/g, ' ')
                        .replace(/\\text\{([^}]+)\}/g, '$1')
                        .replace(/\\[a-zA-Z]+/g, '')
                        .replace(/[{}]/g, '')
                        .replace(/\s+/g, ' ')
                        .trim();
                }
                
                updateProgress(5, 'Creating header...');
                
                // Header Section
                doc.setFillColor(102, 126, 234);
                doc.rect(0, 0, pageWidth, 50, 'F');
                
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.setFont('helvetica', 'bold');
                doc.text('UOS Mock Test Batch 2k26 - Test 2', margin, 20);
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'normal');
                doc.text('Academic Test Results Report', margin, 32);
                
                doc.setFontSize(10);
                doc.text(`Generated on: ${new Date().toLocaleString()}`, margin, 42);
                
                yPos = 60;
                doc.setTextColor(0, 0, 0);
                
                updateProgress(10, 'Adding result summary...');
                
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(102, 126, 234);
                doc.text('TEST RESULTS SUMMARY', margin, yPos);
                
                yPos += 20;
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(0, 0, 0);
                doc.text(`Total Marks: ${totalMarks}`, margin, yPos);
                yPos += 10;
                doc.text(`Obtained Marks: ${obtainedMarks}`, margin, yPos);
                yPos += 10;
                doc.text(`Percentage: ${percentage.toFixed(2)}%`, margin, yPos);
                yPos += 10;
                doc.text(`Grade: ${grade}`, margin, yPos);
                yPos += 10;
                doc.text(`Remarks: ${remarks}`, margin, yPos);
                yPos += 20;
                
                updateProgress(40, 'Adding question details...');
                
                yPos += 15;
                
                // Summary box
                doc.setDrawColor(102, 126, 234);
                doc.setLineWidth(0.5);
                doc.rect(margin, yPos, pageWidth - 2 * margin, 55);
                
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(0, 0, 0);
                
                const minutes = Math.floor(results.timeTaken / 60);
                const seconds = results.timeTaken % 60;
                
                const summaryInfo = [
                    `Marks Obtained: ${results.obtainedMarks}/${results.totalMarks}`,
                    `Percentage: ${results.obtainedMarks}%`,
                    `Result Status: ${results.isPassed ? 'PASS' : 'FAIL'}`,
                    `Time Taken: ${minutes}:${seconds.toString().padStart(2, '0')} minutes`,
                    `Questions Attempted: ${results.totalAttempted}/100`,
                    `Correct Answers: ${results.correctAnswers}`,
                    `Incorrect Answers: ${results.totalAttempted - results.correctAnswers}`,
                    `Unattempted: ${100 - results.totalAttempted}`
                ];
                
                // Better alignment for summary information
                summaryInfo.forEach((info, index) => {
                    const x = (index % 2 === 0) ? margin + 10 : (pageWidth / 2) + 5;
                    const y = yPos + 15 + Math.floor(index / 2) * 12;
                    doc.text(info, x, y);
                });
                
                yPos += 65;
                checkPageOverflow();
                
                updateProgress(15, 'Creating section-wise question analysis...');
                
                // Section-wise Question Analysis
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(102, 126, 234);
                doc.text('DETAILED SECTION-WISE ANALYSIS', margin, yPos);
                yPos += 20; // Increased spacing after section title
                
                // Process sections in order
                const sectionOrder = ['English', 'General Knowledge', 'Science', 'Mathematics', 'I.Q'];
                let questionCounter = 0;
                
                // Log available sections for debugging
                console.log('Available sections:', Object.keys(questionsData));
                
                for (const sectionName of sectionOrder) {
                    // Skip if section doesn't exist in questionsData
                    if (!questionsData[sectionName]) {
                        console.warn(`Section "${sectionName}" not found in questionsData. Available sections:`, Object.keys(questionsData));
                        continue;
                    }
                    
                    const sectionQuestions = questionsData[sectionName];
                    
                    // Update progress
                    const sectionProgress = 15 + Math.floor((questionCounter / 100) * 70);
                    updateProgress(sectionProgress, `Processing ${sectionName} section...`);
                    
                    // Check if we need a new page for section header
                    checkPageOverflow(20);
                    
                    // Section Header
                    doc.setFillColor(52, 58, 64);
                    // Improved sizing and positioning for section headers
                    doc.rect(margin, yPos - 3, pageWidth - 2 * margin, 15, 'F');
                    
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(14);
                    doc.setFont('helvetica', 'bold');
                    // Better vertical alignment for section headers
                    doc.text(`${sectionName.toUpperCase()}`, margin + 5, yPos + 4);
                    
                    doc.setTextColor(0, 0, 0);
                    yPos += 20; // Increased spacing after section header
                    
                    // Process questions in this section
                    for (const question of sectionQuestions) {
                        const userAnswer = results.answers[question.id];
                        const isCorrect = (userAnswer - 1) === question.correct;
                        const isAttempted = userAnswer !== undefined;
                        
                        questionCounter++;
                        
                        // Check if we need a new page
                        checkPageOverflow(40);
                        
                        // Question header
                        doc.setFillColor(248, 249, 250);
                        doc.rect(margin, yPos - 3, pageWidth - 2 * margin, 15, 'F');
                        
                        doc.setFontSize(11);
                        doc.setFont('helvetica', 'bold');
                        doc.setTextColor(0, 0, 0);
                        doc.text(`Q${question.id}. ${question.topic}`, margin + 5, yPos + 2);
                        
                        // Status badge
                        let statusColor, statusText;
                        if (!isAttempted) {
                            statusColor = [108, 117, 125];
                            statusText = 'NOT ATTEMPTED';
                        } else if (isCorrect) {
                            statusColor = [25, 135, 84];
                            statusText = 'CORRECT';
                        } else {
                            statusColor = [220, 53, 69];
                            statusText = 'INCORRECT';
                        }
                        
                        doc.setFillColor(statusColor[0], statusColor[1], statusColor[2]);
                        const statusWidth = doc.getTextWidth(statusText) + 10;
                        doc.rect(pageWidth - margin - statusWidth, yPos - 3, statusWidth, 15, 'F');
                        doc.setTextColor(255, 255, 255);
                        doc.setFontSize(8);
                        doc.text(statusText, pageWidth - margin - statusWidth + 5, yPos + 3);
                        
                        yPos += 18; // Increased spacing after question header
                        
                        // Question text
                        doc.setTextColor(0, 0, 0);
                        doc.setFontSize(10);
                        doc.setFont('helvetica', 'normal');
                        
                        const questionText = cleanLatexText(question.question);
                        const questionLines = doc.splitTextToSize(questionText, pageWidth - 2 * margin - 15);
                        
                        questionLines.forEach((line, index) => {
                            checkPageOverflow(8);
                            doc.text(line, margin + 8, yPos + 1);
                            yPos += lineHeight + 1;
                        });
                        
                        yPos += 8; // Increased spacing after question text to prevent overlapping
                        
                        // Options
                        question.options.forEach((option, optIndex) => {
                            checkPageOverflow(15); // Increased overflow check spacing
                            
                            const isSelected = userAnswer === (optIndex + 1);
                            const isCorrectOption = optIndex === question.correct;
                            
                            // Calculate option text height first to properly size containers
                            const optionText = cleanLatexText(option);
                            const optionLines = doc.splitTextToSize(optionText, pageWidth - 2 * margin - 20);
                            const optionHeight = (optionLines.length * lineHeight) + 4;
                            
                            // Highlight correct options with green background (always visible)
                            // Also highlight user's selections
                            if (isCorrectOption) {
                                // Always highlight correct answers with green background
                                // Using a lighter green to simulate transparency since we can't use setFillAlpha
                                doc.setFillColor(192, 224, 207); // Light green color
                                doc.rect(margin + 5, yPos - 2, pageWidth - 2 * margin - 10, optionHeight, 'F');
                            } else if (isSelected) {
                                // Highlight incorrect user selections with red background
                                // Using a lighter red to simulate transparency since we can't use setFillAlpha
                                doc.setFillColor(240, 200, 205); // Light red color
                                doc.rect(margin + 5, yPos - 2, pageWidth - 2 * margin - 10, optionHeight, 'F');
                            }
                            
                            // Reset to default after drawing
                            doc.setFillColor(0);
                            
                            // Make correct answers bold for better visibility
                            doc.setFont('helvetica', isCorrectOption ? 'bold' : (isSelected ? 'bold' : 'normal'));
                            
                            // No symbols as requested
                            optionLines.forEach((line, lineIndex) => {
                                if (lineIndex > 0) checkPageOverflow(8);
                                // Proper vertical alignment with calculated positioning
                                doc.text(line, margin + 10, yPos + 2);
                                yPos += lineHeight;
                            });
                            
                            // Add spacing after each option to prevent overlapping
                            yPos += 3;
                        });
                        
                        yPos += 10; // Consistent spacing after options section
                    }
                    
                    yPos += 10; // Increased spacing between sections
                }
                
                updateProgress(95, 'Finalizing PDF...');
                
                // Footer on last page
                yPos = pageHeight - 20;
                doc.setFontSize(8);
                doc.setTextColor(128, 128, 128);
                doc.setFont('helvetica', 'normal');
                doc.text('© 2025 Copyright UOS Mock Test Series Powered By Mock Test Hub', margin, yPos);
                doc.text(`Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}`, margin, yPos + 5);
                
                updateProgress(100, 'Download starting...');
                
                // Save the PDF
                const fileName = `UOS_Academic_Mock_Test_Complete_Report_${new Date().getTime()}.pdf`;
                doc.save(fileName);
                
                // Hide progress modal after a short delay
                setTimeout(() => {
                    document.getElementById('pdfProgress').style.display = 'none';

                }, 1000);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                document.getElementById('pdfProgress').style.display = 'none';
                let errorMessage = 'An error occurred while generating the PDF. ';
                
                // Provide more specific error messages based on the error type
                if (error.message.includes('library')) {
                    errorMessage += 'Please refresh the page and try again. If the problem persists, check your internet connection.';
                } else if (error.message.includes('results')) {
                    errorMessage += 'Please complete the test first before generating a report.';
                } else if (error.message.includes('sectionName')) {
                    errorMessage += 'There was an issue with the section data. Please try again.';
                } else {
                    errorMessage += 'Please try again. Error details: ' + error.message;
                }
                
                // Only show alert in development, remove for production
                console.log('PDF Error: ' + errorMessage);
            }
        }
        
        // Update progress function
        function updateProgress(percentage, text) {
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = text;
        }

        // Theme Toggle
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            
            const themeIcon = document.querySelector('#themeToggle i');
            if (currentTheme === 'dark') {
                themeIcon.className = 'fas fa-sun';
            } else {
                themeIcon.className = 'fas fa-moon';
            }
            
            localStorage.setItem('theme', currentTheme);
        }

        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            currentTheme = savedTheme;
            document.documentElement.setAttribute('data-theme', currentTheme);
            
            const themeIcon = document.querySelector('#themeToggle i');
            if (currentTheme === 'dark') {
                themeIcon.className = 'fas fa-sun';
            } else {
                themeIcon.className = 'fas fa-moon';
            }
        }

        // Initialize Test
        $(document).ready(function() {
            // Initially hide main content and show password modal
            $('#mainContent').hide();
            $('#passwordModal').modal('show');
            generateQuestionPalette();
            initializeTheme();
            
            // Check if required libraries are loaded
            setTimeout(() => {
                if (!checkLibraries()) {
                    console.warn('Some required libraries failed to load. PDF generation may not work properly.');
                }
            }, 3000);
        });

        // Mobile responsive adjustments
        function adjustForMobile() {
            const isMobile = window.innerWidth <= 768;
            
            // Adjust question palette for mobile
            const questionPalette = document.getElementById('questionPalette');
            if (questionPalette) {
                if (isMobile) {
                    questionPalette.style.padding = '6px';
                } else {
                    questionPalette.style.padding = '10px';
                }
            }
            
            // Adjust option cards for mobile
            const optionCards = document.querySelectorAll('.option-card');
            optionCards.forEach(card => {
                if (isMobile) {
                    card.style.padding = '12px 15px';
                    card.style.margin = '6px 0';
                } else {
                    card.style.padding = '15px 20px';
                    card.style.margin = '10px 0';
                }
            });
        }

        // Initialize mobile adjustments
        window.addEventListener('resize', adjustForMobile);
        window.addEventListener('load', adjustForMobile);

        // Keyboard Navigation
        document.addEventListener('keydown', function(e) {
            if ($('#passwordModal').hasClass('show')) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    if (currentQuestion > 1) previousQuestion();
                    break;
                case 'ArrowRight':
                    if (currentQuestion < totalQuestions) nextQuestion();
                    break;
                case '1':
                case '2':
                case '3':
                case '4':
                    if (!e.ctrlKey && !e.altKey) {
                        selectOption(parseInt(e.key));
                    }
                    break;
                case 'f':
                case 'F':
                    if (!e.ctrlKey && !e.altKey) {
                        toggleFlag();
                    }
                    break;
            }
        });

        // Prevent right-click and keyboard shortcuts
        document.addEventListener('contextmenu', e => e.preventDefault());
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && (e.key === 'u' || e.key === 's' || e.key === 'a' || e.key === 'p')) {
                e.preventDefault();
            }
            if (e.key === 'F12') {
                e.preventDefault();
            }
        });

        // Prevent text selection
        document.addEventListener('selectstart', e => e.preventDefault());

        // Auto-save functionality
        setInterval(function() {
            if (Object.keys(answers).length > 0) {
                localStorage.setItem('mockTestAnswers', JSON.stringify(answers));
                localStorage.setItem('mockTestFlagged', JSON.stringify(Array.from(flaggedQuestions)));
            }
        }, 30000); // Auto-save every 30 seconds
    </script>
</body>
</html>